const t={tagNames:{route:"wcs-route",router:"wcs-router",outlet:"wcs-outlet",layout:"wcs-layout",layoutOutlet:"wcs-layout-outlet",link:"wcs-link",head:"wcs-head"},enableShadowRoot:!1,basenameFileExtensions:[".html"]},e=t;function a(){return"undefined"!=typeof crypto&&crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){const e=16*Math.random()|0;return("x"===t?e:3&e|8).toString(16)})}function s(t){throw new Error(`[@wcstack/router] ${t}`)}class n extends Error{fallbackPath;constructor(t,e){super(t),this.fallbackPath=e}}const i={int:{typeName:"int",pattern:/^-?\d+$/,parse(t){if(this.pattern.test(t))return parseInt(t,10)}},float:{typeName:"float",pattern:/^-?\d+(?:\.\d+)?$/,parse(t){if(this.pattern.test(t))return parseFloat(t)}},bool:{typeName:"bool",pattern:/^(true|false|0|1)$/,parse(t){if(this.pattern.test(t))return"true"===t||"1"===t}},uuid:{typeName:"uuid",pattern:/^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i,parse(t){if(this.pattern.test(t))return t}},slug:{typeName:"slug",pattern:/^[a-z0-9]+(?:-[a-z0-9]+)*$/,parse(t){if(this.pattern.test(t))return t}},isoDate:{typeName:"isoDate",pattern:/^\d{4}-\d{2}-\d{2}$/,parse(t){if(!this.pattern.test(t))return;const[e,a,s]=t.split("-").map(Number),n=new Date(e,a-1,s);return n.getFullYear()===e&&n.getMonth()===a-1&&n.getDate()===s?n:void 0}},any:{typeName:"any",pattern:/^.+$/,parse(t){if(this.pattern.test(t))return t}}},o={static:2,param:1,"catch-all":0};class r extends HTMLElement{_name="";_path="";_routeParentNode=null;_routeChildNodes=[];_routerNode=null;_uuid=a();_placeHolder=document.createComment(`@@route:${this._uuid}`);_childNodeArray;_paramNames;_absoluteParamNames;_params={};_typedParams={};_weight;_absoluteWeight;_childIndex=0;_hasGuard=!1;_guardHandler=null;_waitForSetGuardHandler=null;_resolveSetGuardHandler=null;_guardFallbackPath="";_initialized=!1;_isFallbackRoute=!1;_segmentCount;_segmentInfos=[];_absoluteSegmentInfos;constructor(){super()}get routeParentNode(){return this._routeParentNode}get routeChildNodes(){return this._routeChildNodes}get routerNode(){return this._routerNode||s(`${e.tagNames.route} has no routerNode.`),this._routerNode}get path(){return this._path}get isRelative(){return!this._path.startsWith("/")}_checkParentNode(t,a){return this._isFallbackRoute||(this.isRelative&&!this._routeParentNode&&s(`${e.tagNames.route} is relative but has no parent route.`),!this.isRelative&&this._routeParentNode&&s(`${e.tagNames.route} is absolute but has a parent route.`)),this.isRelative&&this._routeParentNode?t(this._routeParentNode):a()}get absolutePath(){return this._checkParentNode(t=>{const e=t.absolutePath;return e.endsWith("/")?e+this._path:e+"/"+this._path},()=>this._path)}get uuid(){return this._uuid}get placeHolder(){return this._placeHolder}get childNodeArray(){return void 0===this._childNodeArray&&(this._childNodeArray=Array.from(this.childNodes)),this._childNodeArray}get routes(){return this.routeParentNode?this.routeParentNode.routes.concat(this):[this]}get segmentInfos(){return this._segmentInfos}get absoluteSegmentInfos(){return void 0===this._absoluteSegmentInfos&&(this._absoluteSegmentInfos=this._checkParentNode(t=>[...t.absoluteSegmentInfos,...this._segmentInfos],()=>[...this._segmentInfos])),this._absoluteSegmentInfos}get params(){return this._params}get typedParams(){return this._typedParams}get paramNames(){if(void 0===this._paramNames){const t=[];for(const e of this._segmentInfos)e.paramName&&t.push(e.paramName);this._paramNames=t}return this._paramNames}get absoluteParamNames(){return void 0===this._absoluteParamNames&&(this._absoluteParamNames=this._checkParentNode(t=>[...t.absoluteParamNames,...this.paramNames],()=>[...this.paramNames])),this._absoluteParamNames}get weight(){if(void 0===this._weight){let t=0;for(const e of this._segmentInfos)t+=o[e.type];this._weight=t}return this._weight}get absoluteWeight(){return void 0===this._absoluteWeight&&(this._absoluteWeight=this._checkParentNode(t=>t.absoluteWeight+this.weight,()=>this.weight)),this._absoluteWeight}get childIndex(){return this._childIndex}get name(){return this._name}async guardCheck(t){if(this._hasGuard&&this._waitForSetGuardHandler&&await this._waitForSetGuardHandler,this._guardHandler){const e=t.path,a=t.lastPath;if(!await this._guardHandler(e,a))throw new n("Navigation cancelled by guard.",this._guardFallbackPath)}}shouldChange(t){for(const e of this.paramNames)if(this.params[e]!==t[e])return!0;return!1}get guardHandler(){return this._guardHandler||s(`${e.tagNames.route} has no guardHandler.`),this._guardHandler}set guardHandler(t){this._resolveSetGuardHandler?.(),this._guardHandler=t}initialize(t,a){if(this._initialized)return;this._initialized=!0,this.hasAttribute("path")?this._path=this.getAttribute("path")||"":this.hasAttribute("index")?this._path="":this.hasAttribute("fallback")?(this._path="",this._isFallbackRoute=!0):s(`${e.tagNames.route} should have a "path" or "index" attribute.`),this._name=this.getAttribute("name")||"",this._routerNode=t,this._routeParentNode=a;const n=a||t;n.routeChildNodes.push(this),this._childIndex=n.routeChildNodes.length-1,this._isFallbackRoute&&(a&&s(`${e.tagNames.route} with fallback attribute must be a direct child of ${e.tagNames.router}.`),t.fallbackRoute&&s(`${e.tagNames.router} can have only one fallback route.`),t.fallbackRoute=this),this.hasAttribute("index")&&this._segmentInfos.push({type:"static",segmentText:"",paramName:null,pattern:/^$/,isIndex:!0});const o=this._path.split("/");for(let t=0;t<o.length;t++){const e=o[t];if(!(""===e&&t===o.length-1&&t>0)){if("*"===e){this._segmentInfos.push({type:"catch-all",segmentText:e,paramName:"*",pattern:new RegExp("^(.*)$")});break}if(e.startsWith(":")){const t=e.match(/^:([^()]+)(\(([^)]+)\))?$/);let a,s="any";t?(a=t[1],t[3]&&Object.keys(i).includes(t[3])&&(s=t[3])):a=e.substring(1),this._segmentInfos.push({type:"param",segmentText:e,paramName:a,pattern:new RegExp("^([^\\/]+)$"),paramType:s})}else""===e&&this.hasAttribute("index")||this._segmentInfos.push({type:"static",segmentText:e,paramName:null,pattern:new RegExp(`^${e}$`)})}}this._hasGuard=this.hasAttribute("guard"),this._hasGuard&&(this._guardFallbackPath=this.getAttribute("guard")||"/",this._waitForSetGuardHandler=new Promise(t=>{this._resolveSetGuardHandler=t})),this.setAttribute("fullpath",this.absolutePath)}get fullpath(){return this.absolutePath}get segmentCount(){if(void 0===this._segmentCount){let t=0;for(const e of this._segmentInfos)"catch-all"!==e.type&&t++;this._segmentCount=""===this._path?0:t}return this._segmentCount}get absoluteSegmentCount(){return this._checkParentNode(t=>t.absoluteSegmentCount+this.segmentCount,()=>this.segmentCount)}testAncestorNode(t){let e=this._routeParentNode;for(;e;){if(e===t)return!0;e=e.routeParentNode}return!1}clearParams(){this._params={},this._typedParams={}}}const l=new Map;class h extends HTMLElement{_uuid=a();_initialized=!1;constructor(){super()}async _loadTemplateFromSource(t){try{const a=await fetch(t);a.ok||s(`${e.tagNames.layout} failed to fetch layout from source: ${t}, status: ${a.status}`);const n=await a.text();return l.set(t,n),n}catch(a){s(`${e.tagNames.layout} failed to load layout from source: ${t}, error: ${a}`)}}_loadTemplateFromDocument(t){const e=document.getElementById(`${t}`);return e&&e instanceof HTMLTemplateElement?e.innerHTML:null}async loadTemplate(){const t=this.getAttribute("src"),a=this.getAttribute("layout");t&&a&&console.warn(`${e.tagNames.layout} have both "src" and "layout" attributes.`);const s=document.createElement("template");if(t)l.has(t)?s.innerHTML=l.get(t)||"":(s.innerHTML=await this._loadTemplateFromSource(t)||"",l.set(t,s.innerHTML));else if(a){const t=this._loadTemplateFromDocument(a);t?s.innerHTML=t:console.warn(`${e.tagNames.layout} could not find template with id "${a}".`)}return s}get uuid(){return this._uuid}get enableShadowRoot(){return!!this.hasAttribute("enable-shadow-root")||!this.hasAttribute("disable-shadow-root")&&e.enableShadowRoot}get name(){return this.getAttribute("name")||""}_initialize(){this._initialized=!0}connectedCallback(){this._initialized||this._initialize()}}class u extends HTMLElement{_routesNode=null;_lastRoutes=[];_initialized=!1;constructor(){super()}get routesNode(){return this._routesNode||s(`${e.tagNames.outlet} has no routesNode.`),this._routesNode}set routesNode(t){this._routesNode=t}get rootNode(){return this.shadowRoot?this.shadowRoot:this}get lastRoutes(){return this._lastRoutes}set lastRoutes(t){this._lastRoutes=[...t]}_initialize(){e.enableShadowRoot&&this.attachShadow({mode:"open"}),this._initialized=!0}connectedCallback(){this._initialized||this._initialize()}}const c=new Set(["props","states","attr",""]);function d(t,e){t.hasAttribute("data-bind")||s(`${t.tagName} has no 'data-bind' attribute.`);const a=t.getAttribute("data-bind")||"";c.has(a)||s(`${t.tagName} has invalid 'data-bind' attribute: ${a}`);const n=a;for(const[a,s]of Object.entries(e))switch(n){case"props":t.props={...t.props,[a]:s};break;case"states":t.states={...t.states,[a]:s};break;case"attr":t.setAttribute(a,s);break;case"":t[a]=s}}class m extends HTMLElement{_layout=null;_initialized=!1;_layoutChildNodes=[];constructor(){super()}get layout(){return this._layout||s(`${e.tagNames.layoutOutlet} has no layout.`),this._layout}set layout(t){this._layout=t,this.setAttribute("name",t.name)}get name(){return this.layout.name}async _initialize(){this._initialized=!0,this.layout.enableShadowRoot&&this.attachShadow({mode:"open"});const t=await this.layout.loadTemplate();if(this.shadowRoot){this.shadowRoot.appendChild(t.content.cloneNode(!0));for(const t of Array.from(this.layout.childNodes))this._layoutChildNodes.push(t),this.appendChild(t)}else{const a=t.content.cloneNode(!0),s=new Map;a.querySelectorAll("slot").forEach(t=>{const a=t.getAttribute("name")||"";s.has(a)?console.warn(`${e.tagNames.layoutOutlet} duplicate slot name "${a}" in layout template.`):s.set(a,t)});const n=new Map,i=document.createDocumentFragment();for(const t of Array.from(this.layout.childNodes)){if(this._layoutChildNodes.push(t),t instanceof Element){const e=t.getAttribute("slot")||"";if(e.length>0&&s.has(e)){n.has(e)||n.set(e,document.createDocumentFragment()),n.get(e)?.appendChild(t);continue}}i.appendChild(t)}for(const[t,e]of s){const a=n.get(t);a&&e.replaceWith(a)}const o=s.get("");o&&o.replaceWith(i),this.appendChild(a)}}async connectedCallback(){this._initialized||await this._initialize()}assignParams(t){for(const e of this._layoutChildNodes)e instanceof Element&&(e.querySelectorAll("[data-bind]").forEach(e=>{d(e,t)}),e.hasAttribute("data-bind")&&d(e,t))}}function p(){return document.createElement(e.tagNames.layoutOutlet)}function _(t,e){let a=t.get(e.absolutePath);a||(a=[]);for(const t of a)if(!e.testAncestorNode(t)){console.warn(`Duplicate route path detected: '${e.absolutePath}' (defined as '${e.path}')`);break}a.push(e),1===a.length&&t.set(e.absolutePath,a)}async function g(t,a,s,n,i){const o=s.length>0?s[s.length-1]:null,r=document.createDocumentFragment(),l=Array.from(a.childNodes);for(const a of l)if(a.nodeType===Node.ELEMENT_NODE){let l=a,h=a;const u=h.tagName.toLowerCase();if(u===e.tagNames.route){const e=document.createDocumentFragment();for(const t of Array.from(h.childNodes))e.appendChild(t);const a=document.importNode(h,!0);customElements.upgrade(a),a.appendChild(e);const r=a;r.initialize(t,o),_(i,r),s.push(r),n.set(r.uuid,r),l=r.placeHolder,h=r}else if(u===e.tagNames.layout){const t=document.createDocumentFragment();for(const e of Array.from(h.childNodes))t.appendChild(e);const e=document.importNode(h,!0);customElements.upgrade(e),e.appendChild(t);const a=e,s=p();s.layout=a,l=s,h=e}const c=await g(t,h,s,n,i);h.innerHTML="",h.appendChild(c),r.appendChild(l)}else r.appendChild(a);return r}async function f(t){const e=new Map,a=new Map;return await g(t,t.template.content,[],e,a)}function N(t,e,a,s,n,o){const r=a.concat(e),l=function(t,e,a){const s={},n={};let o=!0,r=!1,l=0,h=0;for(;l<t.absoluteSegmentInfos.length;){const e=t.absoluteSegmentInfos[l];if(e.isIndex){l++;continue}if(0===l&&""===e.segmentText&&"static"===e.type){l++;continue}const u=a[h];if(void 0===u){o=!1;break}let c=!1;if("param"===e.type){const t=e.paramType||"any",a=i[t].parse(u);void 0!==a&&(e.paramName&&(s[e.paramName]=u,n[e.paramName]=a),c=!0)}else c=null!==e.pattern.exec(u);if(!c){o=!1;break}if("catch-all"===e.type){const t=a.slice(h).join("/");s["*"]=t,n["*"]=t,r=!0;break}l++,h++}let u=!1;return o&&(r||l===t.absoluteSegmentInfos.length&&h===a.length||l===t.absoluteSegmentInfos.length&&h===a.length-1&&""===a.at(-1))&&(u=!0),u?{path:e,routes:t.routes,params:s,typedParams:n,lastPath:""}:null}(e,s,n);l&&o.push(l);for(const a of e.routeChildNodes)N(t,a,r,s,n,o)}function b(t){t.clearParams();for(const e of t.childNodeArray)e.parentNode?.removeChild(e)}function y(t,a){t.clearParams();for(const e of t.paramNames)t.params[e]=a.params[e],t.typedParams[e]=a.typedParams[e];const s=t.placeHolder.parentNode,n=t.placeHolder.nextSibling;for(const a of t.childNodeArray)if(n?s?.insertBefore(a,n):s?.appendChild(a),a.nodeType===Node.ELEMENT_NODE){const s=a;s.querySelectorAll("[data-bind]").forEach(e=>{d(e,t.typedParams)}),s.hasAttribute("data-bind")&&d(s,t.typedParams),s.querySelectorAll(e.tagNames.layoutOutlet).forEach(e=>{e.assignParams(t.typedParams)}),s.tagName.toLowerCase()===e.tagNames.layoutOutlet&&s.assignParams(t.typedParams)}return!0}async function w(t,a,n,i){const o=t.basename;let r=n;""!==o&&(n===o?r="":n.startsWith(o+"/")&&(r=n.slice(o.length)));const l=""===r?"/":r;let h=function(t,e){const a=[],s=t.routeChildNodes,n=[],i=e.split("/"),o=i.filter((t,e)=>!(0===e&&""===t||e===i.length-1&&""===t&&i.length>1));for(const i of s)N(t,i,a,e,o,n);return n.sort((t,e)=>{const a=t.routes.at(-1),s=e.routes.at(-1),n=a.absoluteSegmentCount-s.absoluteSegmentCount;if(0!==n)return-n;const i=a.absoluteWeight-s.absoluteWeight;return 0!==i?-i:a.childIndex-s.childIndex}),n.length>0?n[0]:null}(t,l);h||(t.fallbackRoute?h={routes:[t.fallbackRoute],params:{},typedParams:{},path:l,lastPath:i}:s(`${e.tagNames.router} No route matched for path: ${l}`)),h.lastPath=i;const u=a.lastRoutes;await async function(t,e,a){const s=new Set(e.routes);for(const t of a)s.has(t)||b(t);try{for(const t of e.routes)await t.guardCheck(e)}catch(e){const a=e;if("fallbackPath"in a){const e=a;return console.warn(`Navigation cancelled: ${a.message}. Redirecting to ${e.fallbackPath}`),void queueMicrotask(()=>{t.navigate(e.fallbackPath)})}throw e}const n=new Set(a);let i=!1;for(const t of e.routes)(!n.has(t)||t.shouldChange(e.params)||i)&&(i=y(t,e))}(t,h,u),t.path=l,a.lastRoutes=h.routes}function v(){const t=window.navigation;return t?"function"!=typeof t.addEventListener||"function"!=typeof t.removeEventListener?null:t:null}class E extends HTMLElement{static _instance=null;_outlet=null;_template=null;_routeChildNodes=[];_basename="";_path="";_initialized=!1;_fallbackRoute=null;_listeningPopState=!1;constructor(){super(),E._instance&&s(`${e.tagNames.router} can only be instantiated once.`),E._instance=this}_normalizePathname(t){let a=t||"/";a.startsWith("/")||(a="/"+a),a=a.replace(/\/{2,}/g,"/");const s=e.basenameFileExtensions;if(s.length>0){const t=new RegExp(`\\/[^/]+(?:${s.map(t=>t.replace(/\./g,"\\.")).join("|")})$`,"i");a=a.replace(t,"")}return""===a&&(a="/"),a.length>1&&a.endsWith("/")&&(a=a.slice(0,-1)),a}_normalizeBasename(t){let a=t||"";if(!a)return"";a.startsWith("/")||(a="/"+a),a=a.replace(/\/{2,}/g,"/");const s=e.basenameFileExtensions;if(s.length>0){const t=new RegExp(`\\/[^/]+(?:${s.map(t=>t.replace(/\./g,"\\.")).join("|")})$`,"i");a=a.replace(t,"")}return a.length>1&&a.endsWith("/")&&(a=a.slice(0,-1)),"/"===a?"":a}_joinInternalPath(t,e){const a=this._normalizeBasename(t);let s=e.startsWith("/")?e:"/"+e;return s=this._normalizePathname(s),a?"/"===s?a+"/":a+s:s}_notifyLocationChange(){window.dispatchEvent(new CustomEvent("wcs:navigate"))}_getBasename(){let t=new URL(document.baseURI).pathname||"/";return"/"===t?"":this._normalizeBasename(t)}static get instance(){return E._instance||s(`${e.tagNames.router} has not been instantiated.`),E._instance}static navigate(t){E.instance.navigate(t)}get basename(){return this._basename}_getOutlet(){let t=document.querySelector(e.tagNames.outlet);return t||(t=document.createElement(e.tagNames.outlet),document.body.appendChild(t)),t}_getTemplate(){return this.querySelector("template")}get outlet(){return this._outlet||s(`${e.tagNames.router} has no outlet.`),this._outlet}get template(){return this._template||s(`${e.tagNames.router} has no template.`),this._template}get routeChildNodes(){return this._routeChildNodes}get path(){return this._path}set path(t){this._path=t}get fallbackRoute(){return this._fallbackRoute}set fallbackRoute(t){this._fallbackRoute=t}async navigate(t){const e=this._joinInternalPath(this._basename,t),a=v();a?.navigate?a.navigate(e):(history.pushState(null,"",e),await w(this,this.outlet,e,this._path),this._notifyLocationChange())}_onNavigateFunc(t){if(!t.canIntercept||t.hashChange||null!==t.downloadRequest)return;const e=this;t.intercept({handler:async()=>{const a=new URL(t.destination.url),s=e._normalizePathname(a.pathname);await w(e,e.outlet,s,e.path)}})}_onNavigate=this._onNavigateFunc.bind(this);_onPopState=async()=>{const t=this._normalizePathname(window.location.pathname);await w(this,this.outlet,t,this._path),this._notifyLocationChange()};async _initialize(){this._initialized=!0,this._basename=this._normalizeBasename(this.getAttribute("basename")||this._getBasename()||"");const t=null!==document.querySelector("base[href]"),a=new URL(window.location.href);""!==this._basename||t||"/"===a.pathname||s(`${e.tagNames.router} basename is empty, but current path is not "/".`),this._outlet=this._getOutlet(),this._outlet.routesNode=this,this._template=this._getTemplate(),this._template||s(`${e.tagNames.router} should have a <template> child element.`);const n=await f(this);this._outlet.rootNode.appendChild(n),0===this.routeChildNodes.length&&s(`${e.tagNames.router} has no route definitions.`);const i=this._normalizePathname(window.location.pathname);await w(this,this.outlet,i,this._path),this._notifyLocationChange()}async connectedCallback(){this._initialized||await this._initialize(),v()?.addEventListener("navigate",this._onNavigate),v()?.addEventListener||this._listeningPopState||(window.addEventListener("popstate",this._onPopState),this._listeningPopState=!0)}disconnectedCallback(){v()?.removeEventListener("navigate",this._onNavigate),this._listeningPopState&&(window.removeEventListener("popstate",this._onPopState),this._listeningPopState=!1),E._instance===this&&(E._instance=null)}}class P extends HTMLElement{_childNodeArray=[];_uuid=a();_commentNode=document.createComment(`@@link:${this._uuid}`);_path="";_router=null;_anchorElement=null;_initialized=!1;_onClick;constructor(){super()}get uuid(){return this._uuid}get commentNode(){return this._commentNode}get router(){if(this._router)return this._router;const t=document.querySelector(e.tagNames.router);if(t)return this._router=t;s(`${e.tagNames.link} is not connected to a router.`)}_initialize(){this.replaceWith(this._commentNode),this._childNodeArray=Array.from(this.childNodes),this._path=this.getAttribute("to")||"",this._initialized=!0}_normalizePathname(t){let e=t||"/";return e.startsWith("/")||(e="/"+e),e=e.replace(/\/{2,}/g,"/"),e.length>1&&e.endsWith("/")&&(e=e.slice(0,-1)),e}_joinInternalPath(t,e){const a=(t||"").replace(/\/{2,}/g,"/").replace(/\/$/,""),s=e.startsWith("/")?e:"/"+e,n=this._normalizePathname(s);return a?"/"===n?a+"/":a+n:n}connectedCallback(){this._initialized||this._initialize();const t=this._commentNode.parentNode;t||s(`${e.tagNames.link} comment node has no parent`);const a=this._commentNode.nextSibling,n=document.createElement("a");this._path.startsWith("/")?n.href=this._joinInternalPath(this.router.basename,this._path):n.href=new URL(this._path).toString();for(const t of this._childNodeArray)n.appendChild(t);a?t.insertBefore(n,a):t.appendChild(n),this._anchorElement=n,v()?.addEventListener("currententrychange",this._updateActiveState),window.addEventListener("wcs:navigate",this._updateActiveState),window.addEventListener("popstate",this._updateActiveState),this._path.startsWith("/")&&!v()?.navigate&&(this._onClick=async t=>{t.defaultPrevented||0===t.button&&(t.metaKey||t.ctrlKey||t.shiftKey||t.altKey||(t.preventDefault(),await this.router.navigate(this._path),this._updateActiveState()))},n.addEventListener("click",this._onClick)),this._updateActiveState()}disconnectedCallback(){v()?.removeEventListener("currententrychange",this._updateActiveState),window.removeEventListener("wcs:navigate",this._updateActiveState),window.removeEventListener("popstate",this._updateActiveState),this._anchorElement&&(this._onClick&&(this._anchorElement.removeEventListener("click",this._onClick),this._onClick=void 0),this._anchorElement.remove());for(const t of this._childNodeArray)t.parentNode?.removeChild(t)}_updateActiveState=()=>{const t=this._normalizePathname(new URL(window.location.href).pathname),e=this._normalizePathname(this._path.startsWith("/")?this._joinInternalPath(this.router.basename,this._path):this._path);this._anchorElement&&(t===e?this._anchorElement.classList.add("active"):this._anchorElement.classList.remove("active"))}}const A=[],C=new Map;let x=!1;class k extends HTMLElement{_initialized=!1;_childElementArray=[];constructor(){super(),this.style.display="none"}_initialize(){if(!this._initialized){this._initialized=!0,this._childElementArray=Array.from(this.children);for(const t of this._childElementArray)this.removeChild(t)}}connectedCallback(){this._initialize(),x||(this._captureInitialHead(),x=!0),A.push(this),this._reapplyHead()}disconnectedCallback(){const t=A.indexOf(this);-1!==t&&A.splice(t,1),this._reapplyHead()}get childElementArray(){return this._initialized||s("Head component is not initialized yet."),this._childElementArray}_getKey(t){const e=t.tagName.toLowerCase();if("title"===e)return"title";if("meta"===e){return`meta:${t.getAttribute("name")||""}:${t.getAttribute("property")||""}:${t.getAttribute("http-equiv")||""}:${t.hasAttribute("charset")?"charset":""}:${t.getAttribute("media")||""}`}if("link"===e){return`link:${t.getAttribute("rel")||""}:${t.getAttribute("href")||""}:${t.getAttribute("media")||""}`}return"base"===e?"base":`${e}:${t.outerHTML.slice(0,100)}`}_findInHead(t){const e=document.head;for(const a of Array.from(e.children))if(this._getKey(a)===t)return a;return null}_captureInitialHead(){const t=document.head;for(const e of Array.from(t.children)){const t=this._getKey(e);C.has(t)||C.set(t,e.cloneNode(!0))}}_reapplyHead(){const t=new Set;for(const e of A)for(const a of e._childElementArray)t.add(this._getKey(a));for(const e of C.keys())t.add(e);for(const e of Array.from(document.head.children))t.add(this._getKey(e));for(const e of t){let t=null;for(let a=A.length-1;a>=0;a--){const s=A[a];for(const a of s._childElementArray)if(this._getKey(a)===e){t=a.cloneNode(!0);break}if(t)break}if(!t&&C.has(e)){t=C.get(e).cloneNode(!0)}const a=this._findInHead(e);t?a?a.replaceWith(t):document.head.appendChild(t):a?.remove()}}}function $(){customElements.get(e.tagNames.layout)||customElements.define(e.tagNames.layout,h),customElements.get(e.tagNames.layoutOutlet)||customElements.define(e.tagNames.layoutOutlet,m),customElements.get(e.tagNames.outlet)||customElements.define(e.tagNames.outlet,u),customElements.get(e.tagNames.route)||customElements.define(e.tagNames.route,r),customElements.get(e.tagNames.router)||customElements.define(e.tagNames.router,E),customElements.get(e.tagNames.link)||customElements.define(e.tagNames.link,P),customElements.get(e.tagNames.head)||customElements.define(e.tagNames.head,k)}function S(e){var a;e&&((a=e).tagNames&&Object.assign(t.tagNames,a.tagNames),"boolean"==typeof a.enableShadowRoot&&(t.enableShadowRoot=a.enableShadowRoot),Array.isArray(a.basenameFileExtensions)&&(t.basenameFileExtensions=a.basenameFileExtensions)),$()}export{S as bootstrapRouter};
//# sourceMappingURL=index.esm.min.js.map
