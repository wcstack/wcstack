const t="data-bind-state",e="wcs-text",n="wcs-for",i="wcs-if",s="wcs-elseif",o="wcs-else",r={state:"wcs-state"},a="en";function l(t){throw new Error(`[@wcstack/state] ${t}`)}const c=".",d={};function u(t){if(d[t])return d[t];const e=new h(t);return d[t]=e,e}class h{path="";segments=[];wildcardCount;wildcardPositions;wildcardPaths;wildcardPathSet;wildcardParentPaths;wildcardParentPathSet;wildcardPathInfos;wildcardPathInfoSet;wildcardParentPathInfos;wildcardParentPathInfoSet;_parentPathInfo=void 0;constructor(t){this.path=t,this.segments=t.split(c).filter(t=>t.length>0),this.wildcardPositions=this.segments.map((t,e)=>"*"===t?e:-1).filter(t=>-1!==t),this.wildcardCount=this.wildcardPositions.length,this.wildcardPaths=this.wildcardPositions.map(t=>this.segments.slice(0,t+1).join(c)),this.wildcardPathSet=new Set(this.wildcardPaths),this.wildcardParentPaths=this.wildcardPositions.map(t=>this.segments.slice(0,t).join(c)),this.wildcardParentPathSet=new Set(this.wildcardParentPaths),this.wildcardPathInfos=this.wildcardPaths.map(t=>t===this.path?this:u(t)),this.wildcardPathInfoSet=new Set(this.wildcardPathInfos),this.wildcardParentPathInfos=this.wildcardParentPaths.map(t=>t===this.path?this:u(t)),this.wildcardParentPathInfoSet=new Set(this.wildcardParentPathInfos)}get parentPathInfo(){if(void 0!==this._parentPathInfo)return this._parentPathInfo;if(0===this.segments.length)return null;const t=this.segments.slice(0,-1).join(c);return this._parentPathInfo=u(t),this._parentPathInfo}}const f=new WeakMap;function p(t){return f.get(t)||null}function g(t,e){null!==e?f.set(t,e):f.delete(t)}function m(){return"undefined"!=typeof crypto&&crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){const e=16*Math.random()|0;return("x"===t?e:3&e|8).toString(16)})}let x=0;class _{uuid=m();parentListIndex;position;length;_index;_version;_indexes;_listIndexes;constructor(t,e){this.parentListIndex=t,this.position=t?t.position+1:0,this.length=this.position+1,this._index=e,this._version=x}get index(){return this._index}set index(t){this._index=t,this._version=++x,this.indexes[this.position]=t}get version(){return this._version}get dirty(){return null!==this.parentListIndex&&(this.parentListIndex.dirty||this.parentListIndex.version>this._version)}get indexes(){return null===this.parentListIndex?void 0===this._indexes&&(this._indexes=[this._index]):(void 0===this._indexes||this.dirty)&&(this._indexes=[...this.parentListIndex.indexes,this._index],this._version=x),this._indexes}get listIndexes(){return null===this.parentListIndex?void 0===this._listIndexes&&(this._listIndexes=[new WeakRef(this)]):void 0===this._listIndexes&&(this._listIndexes=[...this.parentListIndex.listIndexes,new WeakRef(this)]),this._listIndexes}get varName(){return`$${this.position+1}`}at(t){return t>=0?this.listIndexes[t]?.deref()||null:this.listIndexes[this.listIndexes.length+t]?.deref()||null}}function N(t,e){return new _(t,e)}function w(t,e){const n=[];for(let i=0;i<t.length;i++)n.push(N(e,i));return n}function y(t,e,n){if(0===e.length)return;const i=e[0];"class"===i?function(t,e,n){"boolean"!=typeof n&&l("Invalid value for class application: expected boolean, got "+typeof n),t.classList.toggle(e,n)}(t,e[1],n):"attr"===i?function(t,e,n){t.getAttribute(e)!==n&&t.setAttribute(e,n)}(t,e[1],n):"style"===i?function(t,e,n){const i=t.style;i[e]!==n&&(i[e]=n)}(t,e[1],n):1===e.length?function(t,e,n){t[e]!==n&&(t[e]=n)}(t,i,n):function(t,e,n){let i=t[e[0]];for(let t=1;t<e.length-1;t++){const n=e[t];if(null==i)return;i=i[n]}i[e[e.length-1]]!==n&&(i[e[e.length-1]]=n)}(t,e,n)}const b=new Map;function P(t){const e=b.get(t)||null;if(null===e&&"default"===t){const t=document.querySelector(`${r.state}:not([name])`);if(t instanceof mt)return b.set("default",t),t}return e}function I(t,e){null===e?b.delete(t):b.set(t,e)}function S(t){const e=t.node,n=t.placeHolderNode;e!==n&&null!==e.parentNode&&e.parentNode.replaceChild(n,e)}function v(t,e){let n=t;if(0===e.length)return n;for(let t=0;t<e.length&&(n=n?.childNodes[e[t]]??null,null!==n);t++);return n}function L(t,e){const n=[];for(const i of e)if("text"!==i.bindingType)n.push({...i,node:t,placeHolderNode:t});else{const e=document.createTextNode("");n.push({...i,node:t,placeHolderNode:e})}return n}const T=new Set(["if","elseif","else","for"]),$=t=>t.trim();function k(t){l(`filter ${t} requires at least one option`)}function C(t){l(`filter ${t} requires a number as option`)}function E(t){l(`filter ${t} requires a number value`)}function M(t){l(`filter ${t} requires a date value`)}function R(t){return!(!t||isNaN(Number(t)))}const A={eq:t=>{const e=t?.[0]??k("eq");return t=>"number"==typeof t?(R(e)||C("eq"),t===Number(e)):t===e},ne:t=>{const e=t?.[0]??k("ne");return t=>"number"==typeof t?(R(e)||C("ne"),t!==Number(e)):t!==e},not:t=>t=>("boolean"!=typeof t&&l(`filter ${"not"} requires a boolean value`),!t),lt:t=>{const e=t?.[0]??k("lt");return R(e)||C("lt"),t=>("number"!=typeof t&&E("lt"),t<Number(e))},le:t=>{const e=t?.[0]??k("le");return R(e)||C("le"),t=>("number"!=typeof t&&E("le"),t<=Number(e))},gt:t=>{const e=t?.[0]??k("gt");return R(e)||C("gt"),t=>("number"!=typeof t&&E("gt"),t>Number(e))},ge:t=>{const e=t?.[0]??k("ge");return R(e)||C("ge"),t=>("number"!=typeof t&&E("ge"),t>=Number(e))},inc:t=>{const e=t?.[0]??k("inc");return R(e)||C("inc"),t=>("number"!=typeof t&&E("inc"),t+Number(e))},dec:t=>{const e=t?.[0]??k("dec");return R(e)||C("dec"),t=>("number"!=typeof t&&E("dec"),t-Number(e))},mul:t=>{const e=t?.[0]??k("mul");return R(e)||C("mul"),t=>("number"!=typeof t&&E("mul"),t*Number(e))},div:t=>{const e=t?.[0]??k("div");return R(e)||C("div"),t=>("number"!=typeof t&&E("div"),t/Number(e))},mod:t=>{const e=t?.[0]??k("mod");return R(e)||C("mod"),t=>("number"!=typeof t&&E("mod"),t%Number(e))},fix:t=>{const e=t?.[0]??"0";return R(e)||C("fix"),t=>("number"!=typeof t&&E("fix"),t.toFixed(Number(e)))},locale:t=>{const e=t?.[0]??a;return t=>("number"!=typeof t&&E("locale"),t.toLocaleString(e))},uc:t=>t=>String(t).toUpperCase(),lc:t=>t=>String(t).toLowerCase(),cap:t=>t=>{const e=String(t);return 0===e.length?e:1===e.length?e.toUpperCase():e.charAt(0).toUpperCase()+e.slice(1)},trim:t=>t=>String(t).trim(),slice:t=>{const e=t?.[0]??k("slice");return R(e)||C("slice"),t=>String(t).slice(Number(e))},substr:t=>{const e=t?.[0]??k("substr");R(e)||C("substr");const n=t?.[1]??k("substr");return R(n)||C("substr"),t=>String(t).substr(Number(e),Number(n))},pad:t=>{const e=t?.[0]??k("pad");R(e)||C("pad");const n=t?.[1]??"0";return t=>String(t).padStart(Number(e),n)},rep:t=>{const e=t?.[0]??k("rep");return R(e)||C("rep"),t=>String(t).repeat(Number(e))},rev:t=>t=>String(t).split("").reverse().join(""),int:t=>t=>parseInt(String(t),10),float:t=>t=>parseFloat(String(t)),round:t=>{const e=t?.[0]??"0";return R(e)||C("round"),t=>{"number"!=typeof t&&E("round");const n=Math.pow(10,Number(e));return Math.round(t*n)/n}},floor:t=>{const e=t?.[0]??"0";return R(e)||C("floor"),t=>{"number"!=typeof t&&E("floor");const n=Math.pow(10,Number(e));return Math.floor(t*n)/n}},ceil:t=>{const e=t?.[0]??"0";return R(e)||C("ceil"),t=>{"number"!=typeof t&&E("ceil");const n=Math.pow(10,Number(e));return Math.ceil(t*n)/n}},percent:t=>{const e=t?.[0]??"0";return R(e)||C("percent"),t=>("number"!=typeof t&&E("percent"),`${(100*t).toFixed(Number(e))}%`)},date:t=>{const e=t?.[0]??a;return t=>(t instanceof Date||M("date"),t.toLocaleDateString(e))},time:t=>{const e=t?.[0]??a;return t=>(t instanceof Date||M("time"),t.toLocaleTimeString(e))},datetime:t=>{const e=t?.[0]??a;return t=>(t instanceof Date||M("datetime"),t.toLocaleString(e))},ymd:t=>{const e=t?.[0]??"-";return t=>{t instanceof Date||M("ymd");const n=t.getFullYear().toString(),i=(t.getMonth()+1).toString().padStart(2,"0"),s=t.getDate().toString().padStart(2,"0");return`${n}${e}${i}${e}${s}`}},falsy:t=>t=>!1===t||null==t||0===t||""===t||Number.isNaN(t),truthy:t=>t=>!1!==t&&null!=t&&0!==t&&""!==t&&!Number.isNaN(t),defaults:t=>{const e=t?.[0]??k("defaults");return t=>!1===t||null==t||0===t||""===t||Number.isNaN(t)?e:t},boolean:t=>t=>Boolean(t),number:t=>t=>Number(t),string:t=>t=>String(t),null:t=>t=>""===t?null:t},F=(t,e)=>n=>{const i=n[t];return i||l(`filter not found: ${t}`),i(e)};const O=new Map;function B(t){const e=t.indexOf("|");let n="",i=[],s="",o=[];-1!==e?(n=t.slice(0,e).trim(),s=t.slice(e+1).trim(),O.has(s)?o=O.get(s):(i=s.split("|").map($),o=i.map(t=>{const e=t.indexOf("("),n=t.lastIndexOf(")");if(-1!==e&&-1===n&&l(`Invalid filter format: missing closing parenthesis in "${t}"`),-1!==n&&-1===e&&l(`Invalid filter format: missing opening parenthesis in "${t}"`),-1===e){const e=t.trim();return{filterName:e,args:[],filterFn:F(e,[])(A)}}{const i=function(t){const e=[];let n="",i=null;for(let s=0;s<t.length;s++){const o=t[s];i?o===i?i=null:n+=o:'"'===o||"'"===o?i=o:","===o?(e.push(n.trim()),n=""):n+=o}return n.trim()&&e.push(n.trim()),e}(t.substring(e+1,n)),s=t.substring(0,e).trim();return{filterName:s,args:i,filterFn:F(s,i)(A)}}}),O.set(s,o))):n=t.trim();const[r,a="default"]=n.split("@").map($);return{stateName:a,statePathName:r,statePathInfo:u(r),filters:o}}function U(t){const[...e]=t.split(";").map($).filter(t=>t.length>0),n=e.map(t=>{const e=t.indexOf(":");-1===e&&l(`Invalid bindText: "${t}". Missing ':' separator between propPart and statePart.`);const n=t.slice(0,e).trim(),i=t.slice(e+1).trim();if("else"===n)return{propName:"else",propSegments:["else"],propModifiers:[],statePathName:"",statePathInfo:null,stateName:"",filters:[],bindingType:"else"};if("if"===n||"elseif"===n||"for"===n){return{propName:n,propSegments:[n],propModifiers:[],...B(i),bindingType:n}}{const t=B(i),e=function(t){const[e,n]=t.split("#").map($),i=e.split(".").map($);return{propName:e,propSegments:i,propModifiers:n?n.split(",").map($):[]}}(n);return e.propSegments[0].startsWith("on")?{...e,...t,bindingType:"event"}:{...e,...t,bindingType:"prop"}}});if(n.length>1){n.some(t=>T.has(t.bindingType))&&l(`Invalid bindText: "${t}". 'if', 'elseif', 'else', and 'for' bindings must be single binding.`)}return n}const W=new WeakMap,D=new Set([e,n,i,s,o]),j=new RegExp("^\\s*@@\\s*(.*?)\\s*:\\s*(.+?)\\s*$");const z=new Map;function q(t,e){null===e?z.delete(t):z.set(t,e)}function H(t){return z.get(t)||null}function V(e){if(e.nodeType===Node.ELEMENT_NODE){return U(e.getAttribute(t)||"")}if(e.nodeType===Node.COMMENT_NODE){const t=function(t){return W.get(t)||null}(e);null===t&&l("Comment node binding text not found.");const n=H(t);let i=n?.parseBindTextResult??null,s=null;return null===i?(i={propName:"textContent",propSegments:["textContent"],propModifiers:[],...B(t),bindingType:"text"},s=null):s=t,[{...i,uuid:s}]}return[]}function J(n){const i=[],s=document.createTreeWalker(n,NodeFilter.SHOW_ELEMENT|NodeFilter.SHOW_COMMENT,{acceptNode(n){if(n.nodeType===Node.ELEMENT_NODE){return n.hasAttribute(t)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}return function(t){if(t.nodeType!==Node.COMMENT_NODE)return!1;const n=t.data.trim(),i=j.exec(n);if(null===i)return!1;const s=i[1]||e;return!!D.has(s)&&(W.set(t,i[2]),!0)}(n)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;s.nextNode();)i.push(s.currentNode);return i}const K=new WeakSet;const Y=new Map,G=new Map;function Q(t){if(!t.propName.startsWith("on"))return!1;const e=function(t){return`${t.stateName}::${t.statePathName}`}(t);let n=Y.get(e);var i,s;void 0===n&&(i=t.stateName,s=t.statePathName,n=t=>{const e=P(i);null===e&&l(`State element with name "${i}" not found for event handler.`);const n=e.state[s];return"function"!=typeof n&&l(`Handler "${s}" is not a function on state "${i}".`),n.call(e.state,t)},Y.set(e,n));const o=t.propName.slice(2);t.node.addEventListener(o,n);let r=G.get(e);return void 0===r?(r=new Set([t]),G.set(e,r)):r.add(t),!0}const X=new Set(["radio","checkbox"]),Z=new Set(["value","valueAsNumber","valueAsDate"]);const tt=new WeakMap;function et(t){return tt.get(t)||null}function nt(t,e){null!==e?tt.set(t,e):tt.delete(t)}const it=new Map,st=new Map;function ot(t){if(function(t,e){if(t.nodeType!==Node.ELEMENT_NODE)return!1;const n=t,i=n.tagName.toLowerCase();if("input"===i){const t=(n.getAttribute("type")||"text").toLowerCase();if("button"===t)return!1;if(X.has(t)&&"checked"===e)return!0;if(Z.has(e))return!0}return"select"===i&&"value"===e||"textarea"===i&&"value"===e}(t.node,t.propName)&&-1===t.propModifiers.indexOf("ro")){const s=function(t){let e="select"===t.node.tagName.toLowerCase()?"change":"input";for(const n of t.propModifiers)n.startsWith("on")&&(e=n.slice(2));return e}(t),o=function(t,e){return`${t.stateName}::${t.propName}::${t.statePathName}::${e}`}(t,s);let r=it.get(o);void 0===r&&(e=t.stateName,n=t.propName,i=t.statePathName,r=t=>{const s=t.target;if(void 0===s)return void console.warn("[@wcstack/state] event.target is undefined.");if(!(n in s))return void console.warn(`[@wcstack/state] Property "${n}" does not exist on target element.`);const o=s[n],r=P(e);null===r&&l(`State element with name "${e}" not found for two-way binding.`);const a=r.state,c=et(s);a.$stack(c,()=>{a[i]=o})},it.set(o,r)),t.node.addEventListener(s,r);let a=st.get(o);return void 0===a?(a=new Set([t]),st.set(o,a)):a.add(t),!0}var e,n,i;return!1}async function rt(t){const e=[],n=new Map;for(const i of t){const t=P(i.stateName);if(null===t&&l(`State element with name "${i.stateName}" not found for binding.`),S(i),Q(i))continue;ot(i),t.addBindingInfo(i);let s=n.get(t);void 0===s&&(s=new Map,n.set(t,s));const o=s.get(i.statePathName);if(void 0!==o){e.push({bindingInfo:i,value:o});continue}await t.initializePromise;const r=et(i.node),a=t.state,c=a.$stack(r,()=>a[i.statePathName]);e.push({bindingInfo:i,value:c}),s.set(i.statePathName,c)}for(const t of e)ft(t.bindingInfo,t.value)}async function at(t,e){const[n,i]=function(t){const e=J(t),n=[];for(const t of e)if(!K.has(t)){K.add(t);const e=L(t,V(t));n.push(...e)}return[e,n]}(t);for(const t of n);await rt(i)}async function lt(t,e,n){const[i,s]=function(t,e){const n=[],i=[];for(const s of e){const e=v(t,s.nodePath);if(null===e&&l(`Node not found by path [${s.nodePath.join(", ")}] in fragment.`),!K.has(e)){K.add(e);const t=L(e,s.parseBindTextResults);i.push(...t),n.push(e)}}return[n,i]}(t,e);for(const t of i)null!==n&&nt(t,n);await rt(s)}class ct{_content;_childNodeArray=[];_firstNode=null;_lastNode=null;constructor(t){this._content=t,this._childNodeArray=Array.from(this._content.childNodes),this._firstNode=this._childNodeArray.length>0?this._childNodeArray[0]:null,this._lastNode=this._childNodeArray.length>0?this._childNodeArray[this._childNodeArray.length-1]:null}get firstNode(){return this._firstNode}get lastNode(){return this._lastNode}mountAfter(t){const e=t.parentNode,n=t.nextSibling;e&&this._childNodeArray.forEach(t=>{e.insertBefore(t,n)})}unmount(){this._childNodeArray.forEach(t=>{t.parentNode&&t.parentNode.removeChild(t)})}}function dt(t){return new ct(t)}const ut=new WeakMap,ht=new WeakMap;function ft(t,e){let n=e;for(const e of t.filters)n=e.filterFn(n);if("text"===t.bindingType)!function(t,e){t.nodeValue!==e&&(t.nodeValue=e)}(t.placeHolderNode,n);else if("prop"===t.bindingType)y(t.node,t.propSegments,n);else if("for"===t.bindingType){if(!t.uuid)throw new Error("BindingInfo for 'for' binding must have a UUID.");!function(t,e,n){const i=H(e);i||l(`Fragment with UUID "${e}" not found.`),ut.get(t);const s=Array.isArray(n)?n:[],o=p(s)||[],r=ht.get(t)||[];for(const t of r)t.unmount();const a=[];let c=t;const d=i.parseBindTextResult.statePathInfo;d||l("List path info not found in fragment bind text result.");const u=i.parseBindTextResult.stateName,h=P(u);h||l(`State element with name "${u}" not found.`);const f=h.loopContextStack;for(const t of o)f.createLoopContext(d,t,e=>{const n=document.importNode(i.fragment,!0);lt(n,i.nodeInfos,t);const s=dt(n);s.mountAfter(c),c=s.lastNode||c,a.push(s)});ht.set(t,a),ut.set(t,s)}(t.node,t.uuid,n)}}class pt{_bindingInfosByPath;_listPaths;_stackListIndex=[];constructor(t,e){this._bindingInfosByPath=t,this._listPaths=e}_getNestValue(t,e,n){let i=e;if(i.path in t)return Reflect.get(t,i.path,n);const s=i.parentPathInfo;if(null===s)return;const o=this._getNestValue(t,s,n);if(null==o)return void console.warn(`[@wcstack/state] Cannot access property "${e.path}" - parent is null or undefined.`);const r=i.segments[i.segments.length-1];if("*"===r){const t=i.wildcardPositions.length;if(0===t||t>this._stackListIndex.length)return void console.warn(`[@wcstack/state] Cannot get value for path "${e.path}" - invalid wildcard depth.`);const n=this._stackListIndex[t-1];return null===n?void console.warn(`[@wcstack/state] Cannot get value for path "${e.path}" because list index is null.`):Reflect.get(o,n.index)}return r in o?Reflect.get(o,r):void console.warn(`[@wcstack/state] Property "${e.path}" does not exist on state.`)}$stack(t,e,n){this._stackListIndex.push(t);try{return Reflect.apply(e,n,[])}finally{this._stackListIndex.pop()}}get(t,e,n){let i;try{if("string"==typeof e){if("$stack"===e)return(t,e)=>this.$stack(t,e,n);const s=u(e);if(s.segments.length>1)return i=this._getNestValue(t,s,n)}return e in t?i=Reflect.get(t,e,n):void console.warn(`[@wcstack/state] Property "${String(e)}" does not exist on state.`)}finally{if("string"==typeof e&&this._listPaths.has(e)&&null!=i&&null===p(i)){g(i,w(i,this._stackListIndex.length>0?this._stackListIndex[this._stackListIndex.length-1]:null))}}}set(t,e,n,i){let s=!1;if("string"==typeof e){const o=u(e);if(o.segments.length>1){if(null===o.parentPathInfo)return!1;const e=this._getNestValue(t,o.parentPathInfo,i);if(null==e)return console.warn(`[@wcstack/state] Cannot set property "${o.path}" - parent is null or undefined.`),!1;const r=o.segments[o.segments.length-1];s=Reflect.set(e,r,n)}else s=Reflect.set(t,e,n,i);if(this._bindingInfosByPath.has(String(e))){const t=this._bindingInfosByPath.get(String(e))||[];for(const e of t)ft(e,n)}}else s=Reflect.set(t,e,n,i);if("string"==typeof e&&this._listPaths.has(e)&&null!=n){g(n,w(n,this._stackListIndex.length>0?this._stackListIndex[this._stackListIndex.length-1]:null))}return s}}class gt{_loopContextStack=[];createLoopContext(t,e,n){const i=this._loopContextStack[this._loopContextStack.length-1];if(void 0!==i){i.listPathInfo.wildcardCount+1!==t.wildcardCount&&l("Cannot push loop context for a list whose wildcard count is not exactly one more than the current active loop context.");const e=t.wildcardParentPathInfos[t.wildcardParentPathInfos.length-1];i.listPathInfo!==e&&l("Cannot push loop context for a list whose parent wildcard path info does not match the current active loop context.")}else t.wildcardPositions.length>0&&l("Cannot push loop context for a list with wildcard positions when there is no active loop context.");const s={listPathInfo:t,listIndex:e};let o;this._loopContextStack.push(s);try{o=n(s)}finally{if(o instanceof Promise)return o.finally(()=>{this._loopContextStack.pop()});this._loopContextStack.pop()}return o}}class mt extends HTMLElement{_state;_proxyState;_name="default";_initialized=!1;_bindingInfosByPath=new Map;_initializePromise;_resolveInitialize=null;_listPaths=new Set;_isLoadingState=!1;_isLoadedState=!1;_loopContextStack=function(){return new gt}();static get observedAttributes(){return["name","src","state"]}constructor(){super(),this._initializePromise=new Promise(t=>{this._resolveInitialize=t})}get state(){var t,e,n;return void 0===this._state&&l(`${r.state} _state is not initialized yet.`),void 0===this._proxyState&&(this._proxyState=(t=this._state,e=this._bindingInfosByPath,n=this._listPaths,new Proxy(t,new pt(e,n)))),this._proxyState}get name(){return this._name}attributeChangedCallback(t,e,n){"name"===t&&e!==n&&(I(this._name,null),this._name=n,I(this._name,this)),"state"===t&&e!==n&&(this._isLoadedState&&l("The state has already been loaded. The 'state' attribute cannot be changed multiple times."),this._isLoadingState&&l("The state is currently loading. The 'state' attribute cannot be changed during loading."),this._state=function(t){const e=document.getElementById(t);if(e&&"application/json"===e.type)try{return JSON.parse(e.textContent||"{}")}catch(t){l("Failed to parse JSON from script element:"+t)}return{}}(n),this._isLoadedState=!0),"src"===t&&e!==n&&(this._isLoadedState&&l("The state has already been loaded. The 'src' attribute cannot be changed multiple times."),this._isLoadingState&&l("The state is currently loading. The 'src' attribute cannot be changed during loading."),n&&n.endsWith(".json")?(this._isLoadingState=!0,async function(t){try{const e=await fetch(t);return e.ok||l(`Failed to fetch JSON file: ${e.statusText}`),await e.json()}catch(t){return console.error("Failed to load JSON file:",t),{}}}(n).then(t=>{this._isLoadedState=!0,this._state=t}).finally(()=>{this._isLoadingState=!1})):n&&n.endsWith(".js")?(this._isLoadingState=!0,async function(t){try{return(await import(t)).default||{}}catch(t){l(`Failed to load script file: ${t}`)}}(n).then(t=>{this._isLoadedState=!0,this._state=t}).finally(()=>{this._isLoadingState=!1})):l(`Unsupported src file type: ${n}`))}async _initialize(){if(!this._isLoadedState&&!this._isLoadingState){this._isLoadingState=!0;try{const t=this.querySelector('script[type="module"]');t&&(this._state=await async function(t,e){let n=null;const i=`\n//# sourceURL=${e}\n`;if("function"==typeof URL.createObjectURL){const e=new Blob([t.text+i],{type:"application/javascript"}),s=URL.createObjectURL(e);try{n=await import(s)}finally{URL.revokeObjectURL(s)}}else{const e=btoa(String.fromCodePoint(...(new TextEncoder).encode(t.text+i)));n=await import(`data:application/javascript;base64,${e}`)}return n&&"object"==typeof n.default?n.default:{}}(t,`state#${this._name}`),this._isLoadedState=!0)}catch(t){l(`Failed to load state from inner script: ${t.message}`)}finally{this._isLoadingState=!1}}void 0===this._state&&(this._state={})}async connectedCallback(){this._initialized||(await this._initialize(),this._initialized=!0,this._resolveInitialize?.())}disconnectedCallback(){I(this._name,null)}get bindingInfosByPath(){return this._bindingInfosByPath}get initializePromise(){return this._initializePromise}get listPaths(){return this._listPaths}get loopContextStack(){return this._loopContextStack}addBindingInfo(t){const e=t.statePathName,n=this._bindingInfosByPath.get(e);void 0===n?this._bindingInfosByPath.set(e,[t]):n.push(t),"for"===t.bindingType&&this._listPaths.add(e)}deleteBindingInfo(t){const e=t.statePathName,n=this._bindingInfosByPath.get(e);if(void 0!==n){const e=n.indexOf(t);-1!==e&&n.splice(e,1)}}}function xt(t){let e=t;const n=[];for(;null!==e.parentNode;){const t=Array.from(e.parentNode.childNodes).indexOf(e);n.unshift(t),e=e.parentNode}return n}function _t(t){const e=[],n=J(t);for(const t of n){const n=V(t);e.push({nodePath:xt(t),parseBindTextResults:n})}return e}const Nt=new Map([["for",n],["if",i],["elseif",s],["else",o]]);function wt(e){const n=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode(e){if(e instanceof HTMLTemplateElement){if((e.getAttribute(t)||"").length>0)return NodeFilter.FILTER_ACCEPT}return NodeFilter.FILTER_SKIP}});for(;n.nextNode();){const e=n.currentNode,i=U(e.getAttribute(t)||"")[0],s=Nt.get(i.bindingType);if(void 0===s)continue;const o=e.content,r=m(),a=document.createComment(`@@${s}:${r}`);e.replaceWith(a),wt(o),q(r,{fragment:o,parseBindTextResult:i,nodeInfos:_t(o)})}}function yt(){document.addEventListener("DOMContentLoaded",async()=>{wt(document),await at(document.body)})}function bt(){customElements.get(r.state)||customElements.define(r.state,mt),yt()}export{bt as bootstrapState};
//# sourceMappingURL=index.esm.min.js.map
