const t="data-bind-state",e="wcs-text",n="wcs-for",s="wcs-if",o="wcs-elseif",i="wcs-else",r={state:"wcs-state"},a="en",l=!0;function d(t){throw new Error(`[@wcstack/state] ${t}`)}const c=new Map;function u(t){const e=c.get(t)||null;if(null===e&&"default"===t){const t=document.querySelector(`${r.state}:not([name])`);if(t instanceof qe)return c.set("default",t),t}return e}function f(t,e){null===e?c.delete(t):c.set(t,e)}class h{_loopContextStack=[];createLoopContext(t,e,n){const s=this._loopContextStack[this._loopContextStack.length-1];if(void 0!==s){s.elementPathInfo.wildcardCount+1!==t.wildcardCount&&d("Cannot push loop context for a list whose wildcard count is not exactly one more than the current active loop context.");const e=t.wildcardParentPathInfos[t.wildcardParentPathInfos.length-1];s.elementPathInfo!==e&&d("Cannot push loop context for a list whose parent wildcard path info does not match the current active loop context.")}else 1!==t.wildcardCount&&d("Cannot push loop context for a list with wildcard positions when there is no active loop context.");const o={elementPathInfo:t,listIndex:e};let i;this._loopContextStack.push(o);try{i=n(o)}finally{i instanceof Promise?i.finally(()=>{this._loopContextStack.pop()}):this._loopContextStack.pop()}return i}}const p="*",m={};for(let t=0;t<128;t++)m[`$${t+1}`]=t;const g=Object.freeze(m),x={};let y=0;function I(t){if(x[t])return x[t];const e=Object.freeze(new w(t));return x[t]=e,e}class w{id=++y;path;segments;lastSegment;cumulativePaths;cumulativePathSet;cumulativePathInfos;cumulativePathInfoSet;parentPath;wildcardPaths;wildcardPathSet;indexByWildcardPath;wildcardPathInfos;wildcardPathInfoSet;wildcardParentPaths;wildcardParentPathSet;wildcardParentPathInfos;wildcardParentPathInfoSet;wildcardPositions;lastWildcardPath;lastWildcardInfo;wildcardCount;parentPathInfo;constructor(t){const e=e=>t===e?this:I(e),n=t.split("."),s=[],o=[],i=[],r={},a=[],l=[],d=[],c=[];let u="",f="",h=0;for(let t=0;t<n.length;t++)u+=n[t],n[t]===p&&(i.push(u),r[u]=h,a.push(e(u)),l.push(f),d.push(e(f)),c.push(t),h++),s.push(u),o.push(e(u)),f=u,u+=".";const m=i.length>0?i[i.length-1]:null,g=s.length>1?s[s.length-2]:null;this.path=t,this.segments=n,this.lastSegment=n[n.length-1],this.cumulativePaths=s,this.cumulativePathSet=new Set(s),this.cumulativePathInfos=o,this.cumulativePathInfoSet=new Set(o),this.wildcardPaths=i,this.wildcardPathSet=new Set(i),this.indexByWildcardPath=r,this.wildcardPathInfos=a,this.wildcardPathInfoSet=new Set(a),this.wildcardParentPaths=l,this.wildcardParentPathSet=new Set(l),this.wildcardParentPathInfos=d,this.wildcardParentPathInfoSet=new Set(d),this.wildcardPositions=c,this.lastWildcardPath=m,this.lastWildcardInfo=m?e(m):null,this.parentPath=g,this.parentPathInfo=g?e(g):null,this.wildcardCount=h}}const S=new Map;class _{path;segments;paths;wildcardCount;wildcardType;wildcardIndexes;pathInfo;constructor(t){const e=t.split("."),n=e.slice(),s=[];let o=0,i=0,r="",a=0,l="none";const d=[];for(let t=0;t<e.length;t++){const l=e[t];if("*"===l)n[t]="*",d.push(null),o++,a++;else{const e=Number(l);Number.isNaN(e)||(n[t]="*",d.push(e),i++,a++)}r+=l,s.push(r),r+=t<l.length-1?".":""}const c=I(n.join("."));(o>0||i>0)&&(l=o===a?"context":i===a?"all":"partial"),this.path=t,this.segments=e,this.paths=s,this.wildcardCount=a,this.wildcardType=l,this.wildcardIndexes=d,this.pathInfo=c}}function N(t){let e;return S.get(t)??(S.set(t,e=new _(t)),e)}const P=new WeakMap,b=new WeakMap;class v{pathInfo;listIndex;_parentAddress;constructor(t,e){this.pathInfo=t,this.listIndex=e}get parentAddress(){if(void 0!==this._parentAddress)return this._parentAddress;const t=this.pathInfo.parentPathInfo;if(null===t)return null;let e=null;return e=this.pathInfo.segments[this.pathInfo.segments.length-1]===p?this.listIndex?.parentListIndex??null:this.listIndex,this._parentAddress=$(t,e)}}function $(t,e){if(null===e){let e=b.get(t);return void 0!==e||(e=new v(t,null),b.set(t,e)),e}{let n=P.get(e);void 0===n&&(n=new WeakMap,P.set(e,n));let s=n.get(t);return void 0!==s||(s=new v(t,e),n.set(t,s)),s}}Set.prototype.difference||(Set.prototype.difference=function(t){const e=new Set(this);for(const n of t)e.delete(n);return e}),Set.prototype.intersection||(Set.prototype.intersection=function(t){const e=new Set;for(const n of t)this.has(n)&&e.add(n);return e});let C=0;function A(){return`u${(C++).toString(36)}`}let T=0;class M{uuid=A();parentListIndex;position;length;_index;_version;_indexes;_listIndexes;constructor(t,e){this.parentListIndex=t,this.position=t?t.position+1:0,this.length=this.position+1,this._index=e,this._version=T}get index(){return this._index}set index(t){this._index=t,this._version=++T,this.indexes[this.position]=t}get version(){return this._version}get dirty(){return null!==this.parentListIndex&&(this.parentListIndex.dirty||this.parentListIndex.version>this._version)}get indexes(){return null===this.parentListIndex?void 0===this._indexes&&(this._indexes=[this._index]):(void 0===this._indexes||this.dirty)&&(this._indexes=[...this.parentListIndex.indexes,this._index],this._version=T),this._indexes}get listIndexes(){return null===this.parentListIndex?void 0===this._listIndexes&&(this._listIndexes=[new WeakRef(this)]):void 0===this._listIndexes&&(this._listIndexes=[...this.parentListIndex.listIndexes,new WeakRef(this)]),this._listIndexes}get varName(){return`$${this.position+1}`}at(t){return t>=0?this.listIndexes[t]?.deref()||null:this.listIndexes[this.listIndexes.length+t]?.deref()||null}}function L(t,e){return new M(t,e)}const k=new WeakMap;function E(t){return k.get(t)||null}const W=new WeakMap,O=Object.freeze([]),F=new Set;function D(t,e,n,s){const o=Array.isArray(e)&&e.length>0?e:O,i=Array.isArray(n)&&n.length>0?n:O,r=function(t,e){const n=Array.isArray(t)&&t.length>0?t:O,s=Array.isArray(e)&&e.length>0?e:O;let o=W.get(n);return o&&o.get(s)||null}(o,i);if(r)return r;let a;try{if(0===i.length)return a={oldIndexes:s,newIndexes:[],changeIndexSet:F,deleteIndexSet:new Set(s),addIndexSet:F};const e=[];if(0===o.length){for(let n=0;n<i.length;n++){const s=L(t,n);e.push(s)}return a={oldIndexes:s,newIndexes:e,changeIndexSet:F,deleteIndexSet:F,addIndexSet:new Set(e)}}if(function(t,e){if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}(o,i))return a={oldIndexes:s,newIndexes:s,changeIndexSet:F,deleteIndexSet:F,addIndexSet:F};const n=new Map;for(let t=0;t<o.length;t++){const e=o[t];let s=n.get(e);s||(s=[],n.set(e,s)),s.push(t)}const r=new Set,l=new Set;for(let o=0;o<i.length;o++){const a=i[o],d=n.get(a),c=d&&d.length>0?d.shift():void 0;if(void 0===c){const n=L(t,o);e.push(n),l.add(n)}else{const t=s[c];t.index!==o&&(t.index=o,r.add(t)),e.push(t)}}return a={oldIndexes:s,newIndexes:e,changeIndexSet:r,deleteIndexSet:new Set(s).difference(new Set(e)),addIndexSet:l}}finally{void 0!==a&&(!function(t,e,n){let s=W.get(t);s||(s=new WeakMap,W.set(t,s)),s.set(e,n)}(o,i,a),l=i,null!==(d=a.newIndexes)?k.set(l,d):k.delete(l))}var l,d}const R=new WeakMap;function B(t,e){const n=u(t);null===n&&d(`State element with name "${t}" not found.`);let s=R.get(n);if(void 0!==s){let n=s.get(e);return void 0===n&&(n=Object.freeze({address:e,stateName:t}),s.set(e,n)),n}{const o=Object.freeze({address:e,stateName:t});return s=new WeakMap([[e,o]]),R.set(n,s),o}}const j=new WeakMap;function q(t){return j.get(t)??null}function z(t,e){null===e?j.delete(t):j.set(t,e)}function U(t,e,n,s,o){if(!(e.pathInfo.path in t)){const o=H(t,e.parentAddress??d(`address.parentAddress is undefined path: ${e.pathInfo.path}`),n,s),i=e.pathInfo.segments[e.pathInfo.segments.length-1];if(i===p){const t=e.listIndex?.index??d(`address.listIndex?.index is undefined path: ${e.pathInfo.path}`);return Reflect.get(o,t)}return Reflect.get(o,i)}if(!o.getterPaths.has(e.pathInfo.path))return Reflect.get(t,e.pathInfo.path);s.pushAddress(e);try{return Reflect.get(t,e.pathInfo.path,n)}finally{s.popAddress()}}function H(t,e,n,s){!function(t,e){if(t.addressStackIndex>=0){const n=t.lastAddressStack?.pathInfo??null,s=t.stateElement;null!==n&&s.getterPaths.has(n.path)&&n.path!==e.pathInfo.path&&s.addDynamicDependency(e.pathInfo.path,n.path)}}(s,e);const o=s.stateElement;return e.pathInfo.wildcardCount>0||o.getterPaths.has(e.pathInfo.path)?function(t,e,n,s,o){const i=B(o.name,e),r=q(i);if(null!==r)return r.value;const a=U(t,e,n,s,o);return z(i,{value:a}),a}(t,e,n,s,o):U(t,e,n,s,o)}function V(t,e){const n=t.lastAddressStack;if(null==n)return null;const s=n.pathInfo.indexByWildcardPath[e];return void 0===s?null:n.listIndex?.at(s)??null}const J=new WeakMap;function K(t){return J.get(t)??[]}const Y=new WeakMap;function X(t,e){let n,s;if(0===t.wildcardCount||0===e.wildcardCount)return 0;if(1===t.wildcardCount&&e.wildcardCount>0&&e.wildcardPathSet.has(t.path))return 1;t.id<e.id?(n=t,s=e):(n=e,s=t);let o=Y.get(n);if(void 0===o)o=new WeakMap,Y.set(n,o);else{const t=o.get(s);if(void 0!==t)return t}const i=n.wildcardPathSet.intersection(s.wildcardPathSet).size;return o.set(s,i),i}const G=new WeakMap;function Q(t){let e=t;for(;e;){const t=G.get(e);if(t)return t;e=e.parentNode}return null}function Z(t,e){null!==e?G.set(t,e):G.delete(t)}const tt=new WeakMap;function et(t){const e=Q(t.node);if(null===e)return null;let n=tt.get(e);if(void 0===n)n=new WeakMap,tt.set(e,n);else{const e=n.get(t);if(void 0!==e)return e}let s=null;try{const n=X(e.elementPathInfo,t.statePathInfo);return n>0&&(s=e.listIndex.at(n-1)),s}finally{n.set(t,s)}}const nt=new WeakMap;function st(t){let e=null;if(e=nt.get(t)||null,null!==e)return e;if(t.statePathInfo.wildcardCount>0){const n=et(t);null===n&&d(`Cannot resolve state address for binding with wildcard statePathName "${t.statePathName}" because list index is null.`),e=$(t.statePathInfo,n)}else e=$(t.statePathInfo,null);return nt.set(t,e),e}function ot(t){nt.delete(t)}const it=new WeakMap;function rt(t){let e=null;if(e=it.get(t)||null,null!==e)return e;const n=st(t);return e=B(t.stateName,n),it.set(t,e),e}function at(t){it.delete(t)}const lt=new WeakMap;function dt(t){let e=null;return e=lt.get(t)||null,null===e&&(e=[],lt.set(t,e)),e}function ct(t,e){dt(t).push(e)}function ut(t,e){const n=dt(t),s=n.indexOf(e);-1!==s&&n.splice(s,1)}const ft=new WeakMap;function ht(t){return ft.get(t)??[]}const pt=new WeakMap;function mt(t){return pt.get(t)??[]}function gt(t,e,n){!function(t,e){const n=mt(t);for(const t of n)Z(t,e)}(t,e);const s=ht(t);for(const t of s){ct(rt(t),t),_e(t,n)}}function xt(t){const e=ht(t);for(const t of e){ut(rt(t),t),at(t),ot(t)}!function(t){const e=mt(t);for(const t of e)Z(t,null)}(t)}function yt(t){const e=t.node,n=t.replaceNode;e!==n&&null!==e.parentNode&&e.parentNode.replaceChild(n,e)}function It(t,e){let n=t;if(0===e.length)return n;for(let t=0;t<e.length&&(n=n?.childNodes[e[t]]??null,null!==n);t++);return n}function wt(t,e){const n=[];for(const s of e)if("text"!==s.bindingType)n.push({...s,node:t,replaceNode:t});else{const e=document.createTextNode("");n.push({...s,node:t,replaceNode:e})}return n}const St=new Set(["if","elseif","else","for"]);function _t(t){d(`filter ${t} requires at least one option`)}function Nt(t){d(`filter ${t} requires a number as option`)}function Pt(t){d(`filter ${t} requires a number value`)}function bt(t){d(`filter ${t} requires a date value`)}function vt(t){return!(!t||isNaN(Number(t)))}const $t={eq:t=>{const e=t?.[0]??_t("eq");return t=>"number"==typeof t?(vt(e)||Nt("eq"),t===Number(e)):t===e},ne:t=>{const e=t?.[0]??_t("ne");return t=>"number"==typeof t?(vt(e)||Nt("ne"),t!==Number(e)):t!==e},not:t=>t=>("boolean"!=typeof t&&d(`filter ${"not"} requires a boolean value`),!t),lt:t=>{const e=t?.[0]??_t("lt");return vt(e)||Nt("lt"),t=>("number"!=typeof t&&Pt("lt"),t<Number(e))},le:t=>{const e=t?.[0]??_t("le");return vt(e)||Nt("le"),t=>("number"!=typeof t&&Pt("le"),t<=Number(e))},gt:t=>{const e=t?.[0]??_t("gt");return vt(e)||Nt("gt"),t=>("number"!=typeof t&&Pt("gt"),t>Number(e))},ge:t=>{const e=t?.[0]??_t("ge");return vt(e)||Nt("ge"),t=>("number"!=typeof t&&Pt("ge"),t>=Number(e))},inc:t=>{const e=t?.[0]??_t("inc");return vt(e)||Nt("inc"),t=>("number"!=typeof t&&Pt("inc"),t+Number(e))},dec:t=>{const e=t?.[0]??_t("dec");return vt(e)||Nt("dec"),t=>("number"!=typeof t&&Pt("dec"),t-Number(e))},mul:t=>{const e=t?.[0]??_t("mul");return vt(e)||Nt("mul"),t=>("number"!=typeof t&&Pt("mul"),t*Number(e))},div:t=>{const e=t?.[0]??_t("div");return vt(e)||Nt("div"),t=>("number"!=typeof t&&Pt("div"),t/Number(e))},mod:t=>{const e=t?.[0]??_t("mod");return vt(e)||Nt("mod"),t=>("number"!=typeof t&&Pt("mod"),t%Number(e))},fix:t=>{const e=t?.[0]??"0";return vt(e)||Nt("fix"),t=>("number"!=typeof t&&Pt("fix"),t.toFixed(Number(e)))},locale:t=>{const e=t?.[0]??a;return t=>("number"!=typeof t&&Pt("locale"),t.toLocaleString(e))},uc:t=>t=>String(t).toUpperCase(),lc:t=>t=>String(t).toLowerCase(),cap:t=>t=>{const e=String(t);return 0===e.length?e:1===e.length?e.toUpperCase():e.charAt(0).toUpperCase()+e.slice(1)},trim:t=>t=>String(t).trim(),slice:t=>{const e=t?.[0]??_t("slice");return vt(e)||Nt("slice"),t=>String(t).slice(Number(e))},substr:t=>{const e=t?.[0]??_t("substr");vt(e)||Nt("substr");const n=t?.[1]??_t("substr");return vt(n)||Nt("substr"),t=>String(t).substr(Number(e),Number(n))},pad:t=>{const e=t?.[0]??_t("pad");vt(e)||Nt("pad");const n=t?.[1]??"0";return t=>String(t).padStart(Number(e),n)},rep:t=>{const e=t?.[0]??_t("rep");return vt(e)||Nt("rep"),t=>String(t).repeat(Number(e))},rev:t=>t=>String(t).split("").reverse().join(""),int:t=>t=>parseInt(String(t),10),float:t=>t=>parseFloat(String(t)),round:t=>{const e=t?.[0]??"0";return vt(e)||Nt("round"),t=>{"number"!=typeof t&&Pt("round");const n=Math.pow(10,Number(e));return Math.round(t*n)/n}},floor:t=>{const e=t?.[0]??"0";return vt(e)||Nt("floor"),t=>{"number"!=typeof t&&Pt("floor");const n=Math.pow(10,Number(e));return Math.floor(t*n)/n}},ceil:t=>{const e=t?.[0]??"0";return vt(e)||Nt("ceil"),t=>{"number"!=typeof t&&Pt("ceil");const n=Math.pow(10,Number(e));return Math.ceil(t*n)/n}},percent:t=>{const e=t?.[0]??"0";return vt(e)||Nt("percent"),t=>("number"!=typeof t&&Pt("percent"),`${(100*t).toFixed(Number(e))}%`)},date:t=>{const e=t?.[0]??a;return t=>(t instanceof Date||bt("date"),t.toLocaleDateString(e))},time:t=>{const e=t?.[0]??a;return t=>(t instanceof Date||bt("time"),t.toLocaleTimeString(e))},datetime:t=>{const e=t?.[0]??a;return t=>(t instanceof Date||bt("datetime"),t.toLocaleString(e))},ymd:t=>{const e=t?.[0]??"-";return t=>{t instanceof Date||bt("ymd");const n=t.getFullYear().toString(),s=(t.getMonth()+1).toString().padStart(2,"0"),o=t.getDate().toString().padStart(2,"0");return`${n}${e}${s}${e}${o}`}},falsy:t=>t=>!1===t||null==t||0===t||""===t||Number.isNaN(t),truthy:t=>t=>!1!==t&&null!=t&&0!==t&&""!==t&&!Number.isNaN(t),defaults:t=>{const e=t?.[0]??_t("defaults");return t=>!1===t||null==t||0===t||""===t||Number.isNaN(t)?e:t},boolean:t=>t=>Boolean(t),number:t=>t=>Number(t),string:t=>t=>String(t),null:t=>t=>""===t?null:t},Ct=$t,At={input:$t,output:Ct},Tt=(t,e)=>n=>{const s=n[t];return s||d(`filter not found: ${t}`),s(e)};const Mt=new Map;function Lt(t,e){const n=At[e];return t.map(t=>{const s=t.indexOf("("),o=t.lastIndexOf(")");if(-1!==s&&-1===o&&d(`Invalid filter format: missing closing parenthesis in "${t}"`),-1!==o&&-1===s&&d(`Invalid filter format: missing opening parenthesis in "${t}"`),-1===s){const s=t.trim(),o=`${s}():${e}`;let i=Mt.get(o);return void 0===i&&(i=Tt(s,[])(n),Mt.set(o,i)),{filterName:s,args:[],filterFn:i}}{const i=t.substring(s+1,o),r=t.substring(0,s).trim(),a=function(t){const e=[];let n="",s=null;for(let o=0;o<t.length;o++){const i=t[o];s?i===s?s=null:n+=i:'"'===i||"'"===i?s=i:","===i?(e.push(n.trim()),n=""):n+=i}return n.trim()&&e.push(n.trim()),e}(i),l=`${r}(${a.join(",")}):${e}`;let d=Mt.get(l);return void 0===d&&(d=Tt(r,a)(n),Mt.set(l,d)),{filterName:r,args:a,filterFn:d}}})}const kt=t=>t.trim(),Et=new Map;const Wt=new Map;function Ot(t){const e=t.indexOf("|");let n="",s=[],o="",i=[];-1!==e?(n=t.slice(0,e).trim(),o=t.slice(e+1).trim(),Wt.has(o)?i=Wt.get(o):(s=o.split("|").map(kt),i=Lt(s,"output"),Wt.set(o,i))):n=t.trim();const[r,a="default"]=n.split("@").map(kt);return{stateName:a,statePathName:r,statePathInfo:I(r),outFilters:i}}function Ft(t){const[...e]=t.split(";").map(kt).filter(t=>t.length>0),n=e.map(t=>{const e=t.indexOf(":");-1===e&&d(`Invalid bindText: "${t}". Missing ':' separator between propPart and statePart.`);const n=t.slice(0,e).trim(),s=t.slice(e+1).trim();if("else"===n)return{propName:"else",propSegments:["else"],propModifiers:[],statePathName:"#else",statePathInfo:I("#else"),stateName:"",inFilters:[],outFilters:[],bindingType:"else"};if("if"===n||"elseif"===n||"for"===n){return{propName:n,propSegments:[n],propModifiers:[],inFilters:[],...Ot(s),bindingType:n}}{const t=Ot(s),e=function(t){const e=t.indexOf("|");let n="",s=[],o="",i=[];-1!==e?(n=t.slice(0,e).trim(),o=t.slice(e+1).trim(),Et.has(o)?i=Et.get(o):(s=o.split("|").map(kt),i=Lt(s,"input"),Et.set(o,i))):n=t.trim();const[r,a]=n.split("#").map(kt),l=r.split(".").map(kt);return{propName:r,propSegments:l,propModifiers:a?a.split(",").map(kt):[],inFilters:i}}(n);return e.propSegments[0].startsWith("on")?{...e,...t,bindingType:"event"}:{...e,...t,bindingType:"prop"}}});if(n.length>1){n.some(t=>St.has(t.bindingType))&&d(`Invalid bindText: "${t}". 'if', 'elseif', 'else', and 'for' bindings must be single binding.`)}return n}const Dt=new WeakMap,Rt=new Set([e,n,s,o,i]),Bt=new RegExp("^\\s*@@\\s*(.*?)\\s*:\\s*(.+?)\\s*$");function jt(t){const n=Dt.get(t);if("string"==typeof n)return n;if(t.nodeType!==Node.COMMENT_NODE)return null;const s=t.data.trim(),o=Bt.exec(s);if(null===o)return null;const i=o[1]||e;return Rt.has(i)?(Dt.set(t,o[2]),o[2]):null}const qt=new Map;function zt(t,e){null===e?qt.delete(t):qt.set(t,e)}function Ut(t){return qt.get(t)||null}function Ht(e){if(e.nodeType===Node.ELEMENT_NODE){return Ft(e.getAttribute(t)||"")}if(e.nodeType===Node.COMMENT_NODE){const t=jt(e);null===t&&d("Comment node binding text not found.");const n=Ut(t);let s=n?.parseBindTextResult??null,o=null;return null===s?(s={propName:"textContent",propSegments:["textContent"],propModifiers:[],inFilters:[],...Ot(t),bindingType:"text"},o=null):o=t,[{...s,uuid:o}]}return[]}function Vt(e){const n=[],s=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT|NodeFilter.SHOW_COMMENT,{acceptNode(e){if(e.nodeType===Node.ELEMENT_NODE){return e.hasAttribute(t)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}return null!==jt(e)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;s.nextNode();)n.push(s.currentNode);return n}const Jt=new WeakSet;const Kt=new Map,Yt=new Map;function Xt(t){if(!t.propName.startsWith("on"))return!1;const e=function(t){const e=t.propModifiers.filter(t=>"prevent"===t||"stop"===t).sort().join(",");return`${t.stateName}::${t.statePathName}::${e}`}(t);let n=Kt.get(e);var s,o,i;void 0===n&&(s=t.stateName,o=t.statePathName,i=t.propModifiers,n=t=>{i.includes("prevent")&&t.preventDefault(),i.includes("stop")&&t.stopPropagation();const e=t.target,n=u(s);null===n&&d(`State element with name "${s}" not found for event handler.`);const r=Q(e);n.createStateAsync("writable",async e=>{e.$$setLoopContext(r,()=>{const n=e[o];return"function"!=typeof n&&d(`Handler "${o}" is not a function on state "${s}".`),Reflect.apply(n,e,[t,...r?.listIndex.indexes??[]])})})},Kt.set(e,n));const r=t.propName.slice(2);t.node.addEventListener(r,n);let a=Yt.get(e);return void 0===a?(a=new Set([t]),Yt.set(e,a)):a.add(t),!0}const Gt=new Set(["radio","checkbox"]),Qt=new Set(["value","valueAsNumber","valueAsDate"]);const Zt=new Map,te=new Map;function ee(t){if(function(t,e){if(t.nodeType!==Node.ELEMENT_NODE)return!1;const n=t,s=n.tagName.toLowerCase();if("input"===s){const t=(n.getAttribute("type")||"text").toLowerCase();if("button"===t)return!1;if(Gt.has(t)&&"checked"===e)return!0;if(Qt.has(e))return!0}return"select"===s&&"value"===e||"textarea"===s&&"value"===e}(t.node,t.propName)&&-1===t.propModifiers.indexOf("ro")){const i=function(t){let e="select"===t.node.tagName.toLowerCase()?"change":"input";for(const n of t.propModifiers)n.startsWith("on")&&(e=n.slice(2));return e}(t),r=function(t,e){const n=t.inFilters.map(t=>t.filterName+"("+t.args.join(",")+")").join("|");return`${t.stateName}::${t.propName}::${t.statePathName}::${e}::${n}`}(t,i);let a=Zt.get(r);void 0===a&&(e=t.stateName,n=t.propName,s=t.statePathName,o=t.inFilters,a=t=>{const i=t.target;if(void 0===i)return void console.warn("[@wcstack/state] event.target is undefined.");if(!(n in i))return void console.warn(`[@wcstack/state] Property "${n}" does not exist on target element.`);let r=i[n];for(const t of o)r=t.filterFn(r);const a=u(e);null===a&&d(`State element with name "${e}" not found for two-way binding.`);const l=Q(i);a.createState("writable",t=>{t.$$setLoopContext(l,()=>{t[s]=r})})},Zt.set(r,a)),t.node.addEventListener(i,a);let l=te.get(r);return void 0===l?(l=new Set([t]),te.set(r,l)):l.add(t),!0}var e,n,s,o;return!1}function ne(t){const e=new Map;for(const n of t){const t=u(n.stateName);if(null===t&&d(`State element with name "${n.stateName}" not found for binding.`),yt(n),Xt(n))continue;ee(n),t.setBindingInfo(n);let s=e.get(t);void 0===s?e.set(t,[n]):s.push(n)}}function se(t,e){const[n,s]=function(t){const e=Vt(t),n=[];for(const t of e)if(!Jt.has(t)){Jt.add(t);const e=wt(t,Ht(t));n.push(...e)}return[e,n]}(t);for(const t of n)Z(t,e);ne(s);for(const t of s){ct(rt(t),t)}Ne(s)}function oe(t,e){const[n,s]=function(t,e){const n=[],s=[];for(const o of e){const e=It(t,o.nodePath);if(null===e&&d(`Node not found by path [${o.nodePath.join(", ")}] in fragment.`),!Jt.has(e)){Jt.add(e);const t=wt(e,o.parseBindTextResults);s.push(...t),n.push(e)}}return[n,s]}(t,e);return ne(s),{nodes:n,bindingInfos:s}}const ie=new WeakMap;function re(t){let e=t;for(;e;){const t=ie.get(e);if(t)return t;e=e.parentNode}return null}class ae{_content;_childNodeArray=[];_firstNode=null;_lastNode=null;_mounted=!1;constructor(t){this._content=t,this._childNodeArray=Array.from(this._content.childNodes),this._firstNode=this._childNodeArray.length>0?this._childNodeArray[0]:null,this._lastNode=this._childNodeArray.length>0?this._childNodeArray[this._childNodeArray.length-1]:null}get firstNode(){return this._firstNode}get lastNode(){return this._lastNode}get mounted(){return this._mounted}mountAfter(t){const e=t.parentNode,n=t.nextSibling;e&&this._childNodeArray.forEach(t=>{e.insertBefore(t,n)}),this._mounted=!0}unmount(){this._childNodeArray.forEach(t=>{t.parentNode&&t.parentNode.removeChild(t)});const t=ht(this);for(const e of t){if("if"===e.bindingType||"elseif"===e.bindingType||"else"===e.bindingType){const t=re(e.node);null!==t&&t.unmount()}ot(e),at(e)}this._mounted=!1}}function le(t){void 0!==t.uuid&&null!==t.uuid||d("BindingInfo.uuid is null.");const e=Ut(t.uuid);e||d(`Fragment with UUID "${t.uuid}" not found.`);const n=document.importNode(e.fragment,!0),s=oe(n,e.nodeInfos),o=new ae(n);!function(t,e){ft.set(t,e)}(o,s.bindingInfos);const i=[];for(const t of s.bindingInfos)t.statePathName in g&&i.push(t);return function(t,e){J.set(t,e)}(o,i),function(t,e){pt.set(t,e)}(o,s.nodes),function(t,e){null===e?ie.delete(t):ie.set(t,e)}(t.node,o),o}const de=new WeakMap,ce=new WeakMap,ue=new WeakMap;function fe(t){return ue.get(t.node)||[]}function he(t,e){const n=ue.get(t.node);void 0===n?ue.set(t.node,[e]):n.push(e)}const pe=new WeakMap;function me(t){return`${t.bindingType} ${t.statePathName} ${t.outFilters.map(t=>t.filterName).join("|")} ${t.node.isConnected?"(connected)":"(disconnected)"}`}function ge(t,e,n){const s=t.node.isConnected,o=Boolean(n);let i=re(t.node);null===i&&(i=le(t));try{if(o||(l&&console.log(`unmount if content : ${me(t)}`),i.unmount(),xt(i)),o){l&&console.log(`mount if content : ${me(t)}`),i.mountAfter(t.node);gt(i,Q(t.node),e)}}finally{pe.set(t.node,s)}}function xe(t,e,n){const s=t.node,o=t.propSegments;if(1===o.length){const t=o[0];return void(s[t]!==n&&(s[t]=n))}let i=s[o[0]];for(let t=1;t<o.length-1;t++){const e=o[t];if(null==i)return;i=i[e]}i[o[o.length-1]]!==n&&(i[o[o.length-1]]=n)}function ye(t,e){const n=st(e);if(n.pathInfo.path in g){const t=Q(e.node);return null===t&&d(`ListIndex not found for binding: ${e.statePathName}`),function(t,e){null===t.listIndex&&d("ListIndex not found for loopContext:");const n=g[e];void 0===n&&d(`Invalid index name: ${e}`);const s=t.listIndex.at(n);return null===s&&d(`Index not found at position ${n} for loopContext:`),s.index}(t,n.pathInfo.path)}return t.$$getByAddress(n)}const Ie={class:function(t,e,n){const s=t.node,o=t.propSegments[1];"boolean"!=typeof n&&d("Invalid value for class application: expected boolean, got "+typeof n),s.classList.toggle(o,n)},attr:function(t,e,n){const s=t.node,o=t.propSegments[1];s.getAttribute(o)!==n&&s.setAttribute(o,n)},style:function(t,e,n){const s=t.propSegments[1],o=t.node.style;o[s]!==n&&(o[s]=n)}},we={text:function(t,e,n){t.replaceNode.nodeValue!==n&&(t.replaceNode.nodeValue=n)},for:function(t,e,n){const s=t.statePathInfo,o=et(t),i=de.get(t.node),r=D(o,i,n,E(i)||[]);for(const e of r.deleteIndexSet){const n=ce.get(e);void 0!==n&&(n.unmount(),xt(n),he(t,n))}let a=t.node;const l=I(s.path+"."+p),d=e.stateElement.loopContextStack;for(const n of r.newIndexes){let s;if(r.addIndexSet.has(n))d.createLoopContext(l,n,n=>{const o=fe(t);s=o.pop(),void 0===s&&(s=le(t)),gt(s,n,e)});else if(s=ce.get(n),r.changeIndexSet.has(n)){const t=K(s);for(const n of t)_e(n,e)}a.nextSibling!==s.firstNode&&s.mountAfter(a),a=s.lastNode||a,ce.set(n,s)}de.set(t.node,n)},if:ge,else:ge,elseif:ge};function Se(t,e){const n=function(t,e){let n=t;for(const t of e)n=t.filterFn(n);return n}(ye(e.state,t),t.outFilters);let s=we[t.bindingType];if(void 0===s){const e=t.propSegments[0];s=Ie[e],void 0===s&&(s=xe)}s(t,e,n)}function _e(t,e){if("event"!==t.bindingType)if(t.stateName!==e.stateName){const e=u(t.stateName);null===e&&d(`State element with name "${t.stateName}" not found for binding.`),e.createState("readonly",n=>{const s={stateName:t.stateName,stateElement:e,state:n};Se(t,s)})}else Se(t,e)}function Ne(t){let e=0;for(;e<t.length;){let n=t[e];const s=n.stateName,o=u(s);null===o&&d(`State element with name "${s}" not found for binding.`),o.createState("readonly",i=>{const r={stateName:s,stateElement:o,state:i};for(;;){_e(n,r),e++;const o=t[e];if(!o)break;if(o.stateName!==s)break;n=o}})}}const Pe=new class{_queueAbsoluteAddresses=[];constructor(){}enqueueAbsoluteAddress(t){const e=0===this._queueAbsoluteAddresses.length;this._queueAbsoluteAddresses.push(t),e&&queueMicrotask(()=>{const t=this._queueAbsoluteAddresses;this._queueAbsoluteAddresses=[],this._applyChange(t)})}testApplyChange(t){this._applyChange(t)}_applyChange(t){const e=new Set(t),n=[];for(const t of e){const e=dt(t);n.push(...e)}Ne(n)}};function be(){return Pe}const ve=new WeakMap;function $e(t,e){null===e?ve.delete(t):ve.set(t,e)}const Ce=new WeakMap;function Ae(t,e,n){const s=$(I(t.wildcardParentPaths[e]),n),o=Ce.get(s),i=void 0!==o&&E(o)||[],r=t.stateProxy.$$getByAddress(s),a=function(t,e){switch(e){case"old":return t.oldIndexes;case"new":return t.newIndexes;case"add":return t.addIndexSet;case"change":return t.changeIndexSet;case"delete":return t.deleteIndexSet;default:return console.log(`Invalid search type: ${e}`),[]}}(D(s.listIndex,o,r,i),t.searchType);if(e===t.wildcardPaths.length-1)t.targetListIndexes.push(...a);else for(const n of a)Ae(t,e+1,n);t.newValueByAddress.set(s,r)}function Te(t,e,n,s){if(n>1e3&&d(`Maximum dependency depth of 1000 exceeded. Possible circular dependency detected at path: ${e.pathInfo.path}`),t.visited.has(e))return;t.visited.add(e),s(e);const o=e.pathInfo.path,i=t.staticMap.get(o);if(i)for(const r of i){const i=I(r);if(t.listPathSet.has(o)&&i.lastSegment===p){const o=t.stateProxy.$$getByAddress(e),r=Ce.get(e),a=void 0!==r&&E(r)||[],l=D(e.listIndex,r,o,a);for(const e of l.newIndexes){const o=$(i,e);t.result.add(o),Te(t,o,n+1,s)}t.newValueByAddress.set(e,o)}else{const o=$(i,e.listIndex);t.result.add(o),Te(t,o,n+1,s)}}const r=t.dynamicMap.get(o);if(r)for(const o of r){const i=I(o),r=[];if(i.wildcardCount>0){const n=X(e.pathInfo,i);if(i.wildcardCount-n>=1){let s;n>0?(null===e.listIndex&&d(`Cannot expand dynamic dependency with wildcard for non-list address: ${e.pathInfo.path}`),s=e.listIndex.at(n-1)):s=null;const o={targetListIndexes:[],wildcardPaths:i.wildcardPaths,wildcardParentPaths:i.wildcardParentPaths,stateProxy:t.stateProxy,searchType:t.searchType,newValueByAddress:t.newValueByAddress};Ae(o,n,s),r.push(...o.targetListIndexes)}else{null===e.listIndex&&d(`Cannot expand dynamic dependency with wildcard for non-list address: ${e.pathInfo.path}`);const t=e.listIndex.at(n-1);r.push(t)}}else r.push(null);for(const e of r){const o=$(i,e);t.result.add(o),Te(t,o,n+1,s)}}}function Me(t,e,n,s,o,i,r){const a={staticMap:e,dynamicMap:n,result:new Set,listPathSet:s,visited:new Set,stateProxy:o,searchType:i,newValueByAddress:new Map};try{return Te(a,t,0,r),Array.from(a.result)}finally{for(const[t,e]of a.newValueByAddress.entries())Ce.set(t,e)}}function Le(t,e,n,s,o,i){try{if(!(e.pathInfo.path in t)){const n=H(t,e.parentAddress??d(`address.parentAddress is undefined path: ${e.pathInfo.path}`),o,i),r=e.pathInfo.segments[e.pathInfo.segments.length-1];if(r===p){const t=e.listIndex?.index??d(`address.listIndex?.index is undefined path: ${e.pathInfo.path}`);return Reflect.set(n,t,s)}return Reflect.set(n,r,s)}if(!i.stateElement.setterPaths.has(e.pathInfo.path))return Reflect.set(t,e.pathInfo.path,s);i.pushAddress(e);try{return Reflect.set(t,e.pathInfo.path,s,o)}finally{i.popAddress()}}finally{const t=be();t.enqueueAbsoluteAddress(n),Me(e,i.stateElement.staticDependency,i.stateElement.dynamicDependency,i.stateElement.listPaths,o,"new",n=>{if(n===e)return;const s=B(i.stateName,n);z(s,null),t.enqueueAbsoluteAddress(s)})}}function ke(t,e,n,s,o,i){let r=e.parentAddress??d(`address.parentAddress is undefined path: ${e.pathInfo.path}`),a=function(t){return ve.get(t)??null}(r);if(null===a){const e=H(t,r,o,i)??[],n=E(e)??[];a={value:[...e],listIndexes:[...n]},$e(r,a)}try{return Le(t,e,n,s,o,i)}finally{const n=a.value.indexOf(s),l=H(t,r,o,i)??[],d=Array.isArray(l)?E(l)??[]:[],c=e.listIndex.index,u=-1!==n?a.listIndexes[n]:L(r.listIndex,-1);d[c]=u;if(new Set(l).size===a.value.length){for(let t=0;t<d.length;t++)d[t].index=t;$e(r,null)}}}function Ee(t,e,n,s,o){const i=o.stateElement,r=i.elementPaths.has(e.pathInfo.path),a=e.pathInfo.wildcardCount>0||i.getterPaths.has(e.pathInfo.path),l=B(i.name,e);try{return r?ke(t,e,l,n,s,o):Le(t,e,l,n,s,o)}finally{if(a){const t=q(l);null===t?z(l,{value:n}):t.value=n}}}const We=new WeakMap;function Oe(t,e,n,s){const o=function(t,e,n,s){return(e,o,i)=>{const r=I(e),a=s.lastAddressStack?.pathInfo??null,l=s.stateElement;null!==a&&a.path!==r.path&&l.getterPaths.has(a.path)&&l.addDynamicDependency(r.path,a.path),r.wildcardParentPathInfos.length>o.length&&d(`indexes length is insufficient: ${e}`);let c=null;for(let e=0;e<r.wildcardParentPathInfos.length;e++){const i=r.wildcardParentPathInfos[e],a=$(i,c),l=E(H(t,a,n,s));null==l&&d(`ListIndexes not found: ${i.path}`),c=l[o[e]]??d(`ListIndex not found: ${i.path}`)}const u=$(r,c);if(void 0===i)return H(t,u,n,s);Ee(t,u,i,n,s)}}(t,0,n,s);return(e,i)=>{const r=new Map,a=I(e),l=s.lastAddressStack?.pathInfo??null,c=s.stateElement;if(null!==l&&l.path!==a.path&&c.getterPaths.has(l.path)&&c.addDynamicDependency(a.path,l.path),void 0===i){for(let t=0;t<a.wildcardParentPathInfos.length;t++){const e=a.wildcardParentPathInfos[t],n=V(s,e.path);if(n){i=n.indexes;break}}void 0===i&&(i=[])}const u=(e,o,i,a,l,c,f)=>{const h=e[o]??null;if(null===h)return void f.push(c);const p=$(h,i),m=We.get(p),g=void 0!==m&&E(m)||[],x=H(t,p,n,s),y=D(p.listIndex,m,x,g).newIndexes;null===y&&d(`ListIndex not found: ${h.path}`);const I=a[l]??null;if(r.set(p,x),null===I)for(let t=0;t<y.length;t++){const n=y[t];u(e,o+1,n,a,l+1,c.concat(n.index),f)}else{const t=y[I]??d(`ListIndex not found: ${h.path}`);o+1<e.length?u(e,o+1,t,a,l+1,c.concat(t.index),f):f.push(c.concat(t.index))}},f=[];u(a.wildcardParentPathInfos,0,null,i,0,[],f);const h=[];for(let t=0;t<f.length;t++)h.push(o(a.path,f[t]));for(const[t,e]of r.entries())We.set(t,e);return h}}function Fe(t,e,n,s){const o=e.pathInfo;switch(e.wildcardType){case"none":return null;case"context":return V(s,o.wildcardPaths.at(-1)??d(`lastWildcardPath is null: ${e.pathInfo.path}`))??d(`ListIndex not found: ${e.pathInfo.path}`);case"all":{let o=null;for(let i=0;i<e.pathInfo.wildcardCount;i++){const r=e.pathInfo.wildcardParentPathInfos[i]??d(`wildcardParentPathInfo is null: ${e.pathInfo.path}`);o=(E(H(t,$(r,o),n,s))??d(`ListIndex not found: ${r.path}`))[e.wildcardIndexes[i]??d(`wildcardIndex is null: ${e.pathInfo.path}`)]??d(`ListIndex not found: ${r.path}`)}return o}case"partial":d(`Partial wildcard type is not supported yet: ${e.pathInfo.path}`)}}function De(t,e,n){void 0!==t.loopContext&&d("already in loop context"),t.setLoopContext(e);try{if(!e)return n();{const s=$(e.elementPathInfo,e.listIndex);t.pushAddress(s);try{return n()}finally{t.popAddress()}}}finally{t.clearLoopContext()}}function Re(t,e,n,s){const o=g[e];if(void 0!==o){const t=s.lastAddressStack?.listIndex;return t?.indexes[o]??d(`ListIndex not found: ${e.toString()}`)}if("string"==typeof e){if("$$setLoopContextAsync"===e)return(t,e=async()=>{})=>async function(t,e,n){return await De(t,e,n)}(s,t,e);if("$$setLoopContext"===e)return(t,e=()=>{})=>function(t,e,n){return De(t,e,n)}(s,t,e);if("$$getByAddress"===e)return e=>H(t,e,n,s);if("$getAll"===e)return(e,o)=>Oe(t,0,n,s)(e,o);const o=N(e),i=Fe(t,o,n,s),r=$(o.pathInfo,i);return H(t,r,n,s)}if("symbol"==typeof e)return Reflect.get(t,e,n)}class Be{_stateElement;_stateName;_addressStack=[];_addressStackIndex=-1;_loopContext;_mutability;constructor(t,e){this._stateName=t;const n=u(this._stateName);null===n&&d(`StateHandler: State element with name "${this._stateName}" not found.`),this._stateElement=n,this._mutability=e}get stateName(){return this._stateName}get stateElement(){return this._stateElement}get lastAddressStack(){return this._addressStackIndex>=0?this._addressStack[this._addressStackIndex]:null}get addressStack(){return this._addressStack}get addressStackIndex(){return this._addressStackIndex}get loopContext(){return this._loopContext}pushAddress(t){this._addressStackIndex++,this._addressStackIndex>=this._addressStack.length?this._addressStack.push(t):this._addressStack[this._addressStackIndex]=t}popAddress(){if(this._addressStackIndex<0)return null;const t=this._addressStack[this._addressStackIndex];return this._addressStackIndex--,t}setLoopContext(t){this._loopContext=t}clearLoopContext(){this._loopContext=void 0}get(t,e,n){return Re(t,e,n,this)}set(t,e,n,s){return"readonly"===this._mutability&&d(`State "${this._stateName}" is readonly.`),function(t,e,n,s,o){if("string"==typeof e){const i=N(e),r=Fe(t,i,s,o);return Ee(t,$(i.pathInfo,r),n,s,o)}return Reflect.set(t,e,n,s)}(t,e,n,s,this)}has(t,e){return Reflect.has(t,e)}}function je(t){const e=new Set,n=new Set,s=function(t){let e={},n=t;for(;n&&n!==Object.prototype;)Object.assign(e,Object.getOwnPropertyDescriptors(n)),n=Object.getPrototypeOf(n);return e}(t);for(const[t,o]of Object.entries(s))"function"==typeof o.get&&e.add(t),"function"==typeof o.set&&n.add(t);return{getterPaths:e,setterPaths:n}}class qe extends HTMLElement{__state;_name="default";_initialized=!1;_initializePromise;_resolveInitialize=null;_listPaths=new Set;_elementPaths=new Set;_getterPaths=new Set;_setterPaths=new Set;_isLoadingState=!1;_isLoadedState=!1;_loopContextStack=function(){return new h}();_dynamicDependency=new Map;_staticDependency=new Map;_pathSet=new Set;_version=0;static get observedAttributes(){return["name","src","state"]}constructor(){super(),this._initializePromise=new Promise(t=>{this._resolveInitialize=t})}get _state(){return void 0===this.__state&&d(`${r.state} _state is not initialized yet.`),this.__state}set _state(t){this.__state=t,this._listPaths.clear(),this._elementPaths.clear(),this._getterPaths.clear(),this._pathSet.clear();const e=je(t);for(const t of e.getterPaths)this._getterPaths.add(t);for(const t of e.setterPaths)this._setterPaths.add(t)}get name(){return this._name}attributeChangedCallback(t,e,n){"name"===t&&e!==n&&(f(this._name,null),this._name=n,f(this._name,this)),"state"===t&&e!==n&&(this._isLoadedState&&d("The state has already been loaded. The 'state' attribute cannot be changed multiple times."),this._isLoadingState&&d("The state is currently loading. The 'state' attribute cannot be changed during loading."),this._state=function(t){const e=document.getElementById(t);if(e&&"application/json"===e.type)try{return JSON.parse(e.textContent||"{}")}catch(t){d("Failed to parse JSON from script element:"+t)}return{}}(n),this._isLoadedState=!0),"src"===t&&e!==n&&(this._isLoadedState&&d("The state has already been loaded. The 'src' attribute cannot be changed multiple times."),this._isLoadingState&&d("The state is currently loading. The 'src' attribute cannot be changed during loading."),n&&n.endsWith(".json")?(this._isLoadingState=!0,async function(t){try{const e=await fetch(t);return e.ok||d(`Failed to fetch JSON file: ${e.statusText}`),await e.json()}catch(t){return console.error("Failed to load JSON file:",t),{}}}(n).then(t=>{this._isLoadedState=!0,this._state=t}).finally(()=>{this._isLoadingState=!1})):n&&n.endsWith(".js")?(this._isLoadingState=!0,async function(t){try{return(await import(t)).default||{}}catch(t){d(`Failed to load script file: ${t}`)}}(n).then(t=>{this._isLoadedState=!0,this._state=t}).finally(()=>{this._isLoadingState=!1})):d(`Unsupported src file type: ${n}`))}async _initialize(){if(!this._isLoadedState&&!this._isLoadingState){this._isLoadingState=!0;try{const t=this.querySelector('script[type="module"]');t&&(this._state=await async function(t,e){let n=null;const s=`\n//# sourceURL=${e}\n`;if("function"==typeof URL.createObjectURL){const e=new Blob([t.text+s],{type:"application/javascript"}),o=URL.createObjectURL(e);try{n=await import(o)}finally{URL.revokeObjectURL(o)}}else{const e=btoa(String.fromCodePoint(...(new TextEncoder).encode(t.text+s)));n=await import(`data:application/javascript;base64,${e}`)}return n&&"object"==typeof n.default?n.default:{}}(t,`state#${this._name}`),this._isLoadedState=!0)}catch(t){d(`Failed to load state from inner script: ${t.message}`)}finally{this._isLoadingState=!1}}void 0===this.__state&&(this._state={})}async connectedCallback(){this._initialized||(await this._initialize(),this._initialized=!0,this._resolveInitialize?.())}disconnectedCallback(){f(this._name,null)}get initializePromise(){return this._initializePromise}get listPaths(){return this._listPaths}get elementPaths(){return this._elementPaths}get getterPaths(){return this._getterPaths}get setterPaths(){return this._setterPaths}get loopContextStack(){return this._loopContextStack}get dynamicDependency(){return this._dynamicDependency}get staticDependency(){return this._staticDependency}get version(){return this._version}_addDependency(t,e,n){const s=t.get(e);void 0===s?t.set(e,[n]):s.includes(n)||s.push(n)}addDynamicDependency(t,e){this._addDependency(this._dynamicDependency,t,e)}addStaticDependency(t,e){this._addDependency(this._staticDependency,t,e)}setBindingInfo(t){const e=t.statePathName;if("for"===t.bindingType&&(this._listPaths.add(e),this._elementPaths.add(e+"."+p)),!this._pathSet.has(e)){const t=I(e);this._pathSet.add(e),null!==t.parentPath&&this.addStaticDependency(t.parentPath,e)}}_createState(t,e){try{const n=function(t,e,n){const s=new Be(e,n);return new Proxy(t,s)}(this._state,this._name,t);return e(n)}finally{}}async createStateAsync(t,e){return await this._createState(t,e)}createState(t,e){this._createState(t,e)}nextVersion(){return this._version++,this._version}}const ze=/\{\{\s*(.+?)\s*\}\}/g,Ue=new Set(["SCRIPT","STYLE"]);function He(t){!function(t){const e=document.createTreeWalker(t,NodeFilter.SHOW_TEXT),n=[];for(;e.nextNode();)n.push(e.currentNode);for(const t of n)t.parentElement&&Ue.has(t.parentElement.tagName)||Ve(t)}(t);const e=t.querySelectorAll("template");for(const t of e)He(t.content)}function Ve(t){const e=t.data;if(ze.lastIndex=0,!ze.test(e))return;ze.lastIndex=0;const n=document.createDocumentFragment();let s,o=0;for(;null!==(s=ze.exec(e));){s.index>o&&n.appendChild(document.createTextNode(e.slice(o,s.index)));const t=s[1];n.appendChild(document.createComment(`@@: ${t}`)),o=s.index+s[0].length}o<e.length&&n.appendChild(document.createTextNode(e.slice(o))),t.parentNode.replaceChild(n,t)}let Je;const Ke=/^(\s*@@\s*(?:.*?)\s*:\s*)(.+?)(\s*)$/;function Ye(t,e){const n=e+"."+p,s=t.indexOf("|"),o=t.indexOf("@");let i,r;if(-1!==s?(i=t.slice(0,s).trim(),r=t.slice(s)):-1!==o?(i=t.slice(0,o).trim(),r=t.slice(o)):(i=t.trim(),r=""),"."===i)i=n;else{if(!i.startsWith("."))return t;i=n+"."+i.slice(1)}return r.length>0?i+r:i}function Xe(t,e){const n=Ke.exec(t);if(null===n)return t;const s=n[1],o=n[2],i=n[3];return s+Ye(o,e)+i}function Ge(t,e){const n=t.split(";");let s=!1;const o=n.map(t=>{const n=t.trim();if(0===n.length)return t;const o=n.indexOf(":");if(-1===o)return t;const i=n.slice(0,o).trim(),r=n.slice(o+1).trim(),a=Ye(r,e);return a!==r?(s=!0,`${i}: ${a}`):t});return s?o.join(";"):t}function Qe(t,e){return Ge(t,e)}function Ze(t){let e=t;const n=[];for(;null!==e.parentNode;){const t=Array.from(e.parentNode.childNodes).indexOf(e);n.unshift(t),e=e.parentNode}return n}function tn(t){const e=[],n=Vt(t);for(const t of n){const n=Ht(t);e.push({nodePath:Ze(t),parseBindTextResults:n})}return e}const en=new Map([["for",n],["if",s],["elseif",o],["else",i]]),nn=function(){if(Je)return Je;const t=[],e=Tt("not",t)(Ct);return Je={filterName:"not",args:t,filterFn:e},Je}();function sn(t,e){const n=e.outFilters;return{...e,outFilters:[...n,nn],bindingType:t}}function on(e,n,s){"string"==typeof s&&function(e,n){const s=t,o=document.createTreeWalker(e,NodeFilter.SHOW_COMMENT|NodeFilter.SHOW_ELEMENT);for(;o.nextNode();){const t=o.currentNode;if(t.nodeType===Node.COMMENT_NODE){const e=t;e.data=Xe(e.data,n);continue}const e=t;if(e instanceof HTMLTemplateElement)continue;const i=e.getAttribute(s);if(null!==i){const t=Ge(i,n);t!==i&&e.setAttribute(s,t)}}}(e,s),rn(e,s);return{fragment:e,parseBindTextResult:n,nodeInfos:tn(e)}}function rn(e,n){const s=i,o=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode(e){if(e instanceof HTMLTemplateElement){if((e.getAttribute(t)||"").length>0)return NodeFilter.FILTER_ACCEPT}return NodeFilter.FILTER_SKIP}});let r=null;const a=[],l=[];for(;o.nextNode();){const t=o.currentNode;l.push(t)}for(const e of l){let o=e.getAttribute(t)||"";"string"==typeof n&&(o=Qe(o,n));let i=Ft(o)[0];const l=en.get(i.bindingType);if(void 0===l)continue;const c=i.bindingType,u=e.content,f=A();let h=null;const p="for"===c?i.statePathName:n;if("else"===c){null===r&&d("'else' binding found without preceding 'if' or 'elseif' binding."),i=sn("else",r.parseBindTextResult),h=on(u,i,p),zt(f,h);const t=a.at(-1),n=document.createComment(`@@${l}:${f}`);void 0!==t?(e.remove(),t.fragment.appendChild(n),t.nodeInfos.push({nodePath:Ze(n),parseBindTextResults:Ht(n)})):e.replaceWith(n)}else if("elseif"===c){null===r&&d("'elseif' binding found without preceding 'if' or 'elseif' binding."),h=on(u,i,p),zt(f,h);const t=document.createComment(`@@${l}:${f}`),n=A(),o={fragment:document.createDocumentFragment(),parseBindTextResult:sn("else",r.parseBindTextResult),nodeInfos:[]};o.fragment.appendChild(t),o.nodeInfos.push({nodePath:Ze(t),parseBindTextResults:Ht(t)}),zt(n,o);const c=a.at(-1);a.push(o);const m=document.createComment(`@@${s}:${n}`);void 0!==c?(e.remove(),c.fragment.appendChild(m),c.nodeInfos.push({nodePath:Ze(m),parseBindTextResults:Ht(m)})):e.replaceWith(m)}else{h=on(u,i,p),zt(f,h);const t=document.createComment(`@@${l}:${f}`);e.replaceWith(t)}"if"===c?(a.length=0,r=h):"elseif"===c?r=h:"else"===c&&(r=null,a.length=0)}}function an(){document.addEventListener("DOMContentLoaded",async()=>{await async function(){const t=document.querySelectorAll(r.state),e=[];for(const n of t){const t=n;e.push(t.initializePromise)}await Promise.all(e)}(),He(document),rn(document),se(document.body,null)})}function ln(){customElements.get(r.state)||customElements.define(r.state,qe),an()}export{ln as bootstrapState};
//# sourceMappingURL=index.esm.min.js.map
