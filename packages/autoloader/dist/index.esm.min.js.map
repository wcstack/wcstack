{"version":3,"file":"index.esm.min.js","sources":["../src/importmap.ts","../src/config.ts","../src/vanilla.ts","../src/resoleveLoader.ts","../src/tags.ts","../src/eagerload.ts","../src/lazyLoad.ts","../src/handler.ts","../src/addLoader.ts"],"sourcesContent":["import { IImportMap, IKeyInfo, ILoadMap, IPrefixMap } from \"./types.js\";\r\n\r\nconst COMPONENT_KEYWORD = \"@components/\";\r\n\r\nexport function loadImportmap(): IImportMap | null {\r\n  const importmap: IImportMap = { imports: {} };\r\n  document.querySelectorAll('script[type=\"importmap\"]').forEach((script) => {\r\n    try {\r\n      const json = JSON.parse(script.innerHTML);\r\n      if (json.imports) {\r\n        importmap.imports = Object.assign(importmap.imports, json.imports);\r\n      }\r\n    } catch (e) {\r\n      throw new Error(\"Failed to parse importmap JSON: \" + e);\r\n    }\r\n  });\r\n  return Object.keys(importmap.imports).length > 0\r\n    ? importmap\r\n    : null;\r\n}\r\n\r\nfunction getKeyInfoFromImportmapKey(key: string): IKeyInfo | null {\r\n  if (key.startsWith(COMPONENT_KEYWORD)) {\r\n    if (key.endsWith(\"/\")) {\r\n      const prefixWithLoader = key.slice(COMPONENT_KEYWORD.length, key.length - 1);\r\n      const [ prefix, loaderKey ] = prefixWithLoader.split(\"|\", 2);\r\n      if (prefix === \"\") {\r\n        throw new Error(\"Invalid importmap key: \" + key);\r\n      }\r\n      return {\r\n        key,\r\n        prefix: prefix.replaceAll(\"/\", \"-\").toLowerCase(),\r\n        loaderKey: loaderKey ?? null,\r\n        isNameSpaced: true\r\n      };\r\n    } else {\r\n      const tagNamePart = key.slice(COMPONENT_KEYWORD.length);\r\n      const [ tagName, loaderKeyPart ] = tagNamePart.split(\"|\", 2);\r\n      const [ loaderKey, extendsText ] = (loaderKeyPart ?? \"\").split(\",\", 2);\r\n      if (tagName === \"\") {\r\n        throw new Error(\"Invalid importmap key: \" + key);\r\n      }\r\n      return {\r\n        key,\r\n        tagName: tagName.replaceAll(\"/\", \"-\").toLowerCase(),\r\n        loaderKey: loaderKey || null,\r\n        extends: extendsText || null,\r\n        isNameSpaced: false\r\n      };\r\n    }\r\n  }\r\n  return null;\r\n}\r\n\r\nexport function buildMap(importmap: IImportMap): {\r\n  prefixMap: IPrefixMap, loadMap: ILoadMap\r\n} {\r\n  const prefixMap: IPrefixMap = {};\r\n  const loadMap: ILoadMap = {};\r\n  for (const [key, _value] of Object.entries(importmap.imports)) {\r\n    const keyInfo = getKeyInfoFromImportmapKey(key);\r\n    if (keyInfo === null) {\r\n      continue;\r\n    }\r\n    if (keyInfo.isNameSpaced) {\r\n      prefixMap[keyInfo.prefix] = keyInfo;\r\n    } else {\r\n      loadMap[keyInfo.tagName] = keyInfo;\r\n    }\r\n  }\r\n  return { prefixMap, loadMap };\r\n}","\r\nimport { IConfig } from \"./types.js\"\r\nimport { load } from \"./vanilla.js\"\r\n\r\nexport const DEFAULT_KEY = \"*\";\r\n\r\nexport const VANILLA_KEY = \"vanilla\";\r\n\r\nexport const VANILLA_LOADER = {\r\n  postfix: \".js\",\r\n  loader: load\r\n}\r\n\r\nconst DEFAULT_CONFIG: IConfig = {\r\n  scanImportmap: true,\r\n  loaders: {\r\n    [VANILLA_KEY]: VANILLA_LOADER,\r\n    [DEFAULT_KEY]: VANILLA_KEY\r\n  },\r\n  observable: true\r\n}\r\n\r\nexport const config = DEFAULT_CONFIG;","\r\n\r\nexport async function load(path: string): Promise<CustomElementConstructor> {\r\n  const module = await import(path);\r\n  return module.default as CustomElementConstructor;\r\n}","import { DEFAULT_KEY } from \"./config.js\";\r\nimport { ILoader } from \"./types\";\r\n\r\nexport function resolveLoader(\r\n  path: string,\r\n  loaderKey: string | null,\r\n  loaders: Record<string, ILoader | string>\r\n): ILoader {\r\n  let loader: ILoader | string;\r\n\r\n  if (loaderKey === null || loaderKey === DEFAULT_KEY || loaderKey === \"\") {\r\n    // Try to resolve by postfix\r\n    let resolvedLoader: ILoader | null = null;\r\n    \r\n    const candidates: ILoader[] = [];\r\n    for (const [key, l] of Object.entries(loaders)) {\r\n      if (key === DEFAULT_KEY) continue;\r\n      const currentLoader = typeof l === \"string\" ? loaders[l] : l;\r\n      if (typeof currentLoader === \"string\") continue; // Should not happen if config is correct\r\n      candidates.push(currentLoader);\r\n    }\r\n\r\n    // Sort by postfix length descending to match longest extension first\r\n    candidates.sort((a, b) => b.postfix.length - a.postfix.length);\r\n\r\n    for (const currentLoader of candidates) {\r\n      if (path.endsWith(currentLoader.postfix)) {\r\n        resolvedLoader = currentLoader;\r\n        break;\r\n      }\r\n    }\r\n\r\n    if (resolvedLoader) {\r\n      loader = resolvedLoader;\r\n    } else {\r\n      loader = loaders[DEFAULT_KEY];\r\n      if (typeof loader === \"string\") {\r\n        loader = loaders[loader];\r\n      }\r\n    }\r\n  } else {\r\n    loader = loaders[loaderKey];\r\n    if (!loader) {\r\n      throw new Error(\"Loader not found: \" + loaderKey);\r\n    }\r\n  }\r\n\r\n  if (typeof loader === \"string\") {\r\n    throw new Error(\"Loader redirection is not supported here\");\r\n  }\r\n  return loader;\r\n}\r\n","\r\nexport const failedTags = new Set<string>();\r\nexport const loadingTags = new Set<string>();\r\n\r\nexport function resetState() {\r\n  failedTags.clear();\r\n  loadingTags.clear();\r\n}\r\n\r\n","import { resolveLoader } from \"./resoleveLoader.js\";\r\nimport { failedTags } from \"./tags.js\";\r\nimport { IEagerLoadInfo, ILoader } from \"./types.js\";\r\n\r\nconst EXTENDS_MAP = new Map<any, string>();\r\n\r\nif (typeof window !== \"undefined\") {\r\n  const map = [\r\n    [HTMLButtonElement, \"button\"],\r\n    [HTMLInputElement, \"input\"],\r\n    [HTMLAnchorElement, \"a\"],\r\n    [HTMLImageElement, \"img\"],\r\n    [HTMLDivElement, \"div\"],\r\n    [HTMLSpanElement, \"span\"],\r\n    [HTMLParagraphElement, \"p\"],\r\n    [HTMLUListElement, \"ul\"],\r\n    [HTMLOListElement, \"ol\"],\r\n    [HTMLLIElement, \"li\"],\r\n    [HTMLTableElement, \"table\"],\r\n    [HTMLFormElement, \"form\"],\r\n    [HTMLLabelElement, \"label\"],\r\n    [HTMLSelectElement, \"select\"],\r\n    [HTMLTextAreaElement, \"textarea\"],\r\n    [HTMLHeadingElement, \"h1\"],\r\n    [HTMLQuoteElement, \"blockquote\"],\r\n    [HTMLPreElement, \"pre\"],\r\n    [HTMLBRElement, \"br\"],\r\n    [HTMLHRElement, \"hr\"],\r\n    [HTMLModElement, \"ins\"],\r\n    [HTMLTableCaptionElement, \"caption\"],\r\n    [HTMLTableColElement, \"col\"],\r\n    [HTMLTableSectionElement, \"tbody\"],\r\n    [HTMLTableRowElement, \"tr\"],\r\n    [HTMLTableCellElement, \"td\"],\r\n    [HTMLFieldSetElement, \"fieldset\"],\r\n    [HTMLLegendElement, \"legend\"],\r\n    [HTMLDListElement, \"dl\"],\r\n    [HTMLOptGroupElement, \"optgroup\"],\r\n    [HTMLOptionElement, \"option\"],\r\n    [HTMLStyleElement, \"style\"],\r\n    [HTMLScriptElement, \"script\"],\r\n    [HTMLTemplateElement, \"template\"],\r\n    [HTMLCanvasElement, \"canvas\"],\r\n    [HTMLIFrameElement, \"iframe\"],\r\n    [HTMLObjectElement, \"object\"],\r\n    [HTMLEmbedElement, \"embed\"],\r\n    [HTMLVideoElement, \"video\"],\r\n    [HTMLAudioElement, \"audio\"],\r\n    [HTMLTrackElement, \"track\"],\r\n    [HTMLMapElement, \"map\"],\r\n    [HTMLAreaElement, \"area\"],\r\n    [HTMLSourceElement, \"source\"],\r\n    [HTMLParamElement, \"param\"],\r\n    [HTMLMeterElement, \"meter\"],\r\n    [HTMLProgressElement, \"progress\"],\r\n    [HTMLOutputElement, \"output\"],\r\n    [HTMLDetailsElement, \"details\"],\r\n    [HTMLDialogElement, \"dialog\"],\r\n    [HTMLMenuElement, \"menu\"],\r\n    [HTMLSlotElement, \"slot\"],\r\n    [HTMLTimeElement, \"time\"],\r\n    [HTMLDataElement, \"data\"],\r\n    [HTMLPictureElement, \"picture\"],\r\n  ] as const;\r\n\r\n  map.forEach(([cls, tag]) => {\r\n    /* istanbul ignore next */\r\n    if (typeof cls !== \"undefined\") {\r\n      EXTENDS_MAP.set(cls, tag);\r\n    }\r\n  });\r\n}\r\n\r\nfunction resolveExtends(componentConstructor: CustomElementConstructor): string | null {\r\n  for (const [cls, tag] of EXTENDS_MAP) {\r\n    if (componentConstructor.prototype instanceof cls) {\r\n      return tag;\r\n    }\r\n  }\r\n  return null;\r\n}\r\n\r\nasync function eagerLoadItem(info: IEagerLoadInfo, tagName:string, loader: ILoader): Promise<void> {\r\n  try {\r\n    const componentConstructor = await loader.loader(info.key);\r\n    if (componentConstructor !== null) {\r\n      let extendsName = info.extends;\r\n      if (extendsName === null) {\r\n        extendsName = resolveExtends(componentConstructor);\r\n      }\r\n\r\n      if (extendsName === null) {\r\n        customElements.define(tagName, componentConstructor);\r\n      } else {\r\n        customElements.define(tagName, componentConstructor, { extends: extendsName });\r\n      }\r\n    }\r\n  } catch(e) {\r\n    if (!failedTags.has(tagName)) {\r\n      console.error(`Failed to eager load component '${tagName}':`, e);\r\n      failedTags.add(tagName);\r\n    }\r\n  }\r\n\r\n}\r\n\r\nexport async function eagerLoad(\r\n  loadMap: Record<string, IEagerLoadInfo>, \r\n  loaders: Record<string, ILoader | string>\r\n): Promise<void> {\r\n  const promises: Promise<void>[] = [];\r\n  for(const [tagName, info] of Object.entries(loadMap)) {\r\n    let loader: ILoader;\r\n    try {\r\n      loader = resolveLoader(info.key, info.loaderKey, loaders);\r\n    } catch (_e) {\r\n      throw new Error(\"Loader redirection is not supported for eager loaded components: \" + tagName);\r\n    }\r\n    promises.push(eagerLoadItem(info, tagName, loader));\r\n  }\r\n  await Promise.all(promises);\r\n}\r\n","import { resolveLoader } from \"./resoleveLoader\";\r\nimport { failedTags, loadingTags } from \"./tags\";\r\nimport { IConfig, ILoader, INameSpaceInfo, IPrefixMap, ITagInfo } from \"./types\";\r\n\r\nconst isCustomElement = (node: Node): boolean => {\r\n  return (node instanceof Element && (node.tagName.includes(\"-\") || node.getAttribute(\"is\")?.includes(\"-\"))) ?? false;\r\n}\r\n\r\nexport function getCustomTagInfo(e: Element): ITagInfo {\r\n  const elementTagName = e.tagName.toLowerCase();\r\n  let name;\r\n  let extendsName;\r\n  if (elementTagName.includes(\"-\")) {\r\n    name = elementTagName;\r\n    extendsName = null;\r\n  } else {\r\n    const tagName = e.getAttribute(\"is\");\r\n    if (tagName === null) {\r\n      throw new Error(\"Custom element without a dash or 'is' attribute found: \" + elementTagName);\r\n    }\r\n    if (!tagName.includes(\"-\")) {\r\n      throw new Error(\"Custom element 'is' attribute without a dash found: \" + elementTagName);\r\n    }\r\n    name = tagName;\r\n    extendsName = elementTagName;\r\n  }\r\n  return { name, extends: extendsName };\r\n}\r\n\r\nconst observedCustomElements: WeakSet<Element> = new Set();\r\n\r\nasync function observeShadowRoot(element: Element, config: IConfig, prefixMap: IPrefixMap) {\r\n  observedCustomElements.add(element);\r\n  await handlerForLazyLoad(element.shadowRoot!, config, prefixMap);\r\n}\r\n\r\nasync function checkObserveShadowRoot(element: Element, config: IConfig, prefixMap: IPrefixMap) {\r\n  if (element.shadowRoot) {\r\n    if (!observedCustomElements.has(element)) {\r\n      await observeShadowRoot(element, config, prefixMap);\r\n    }\r\n  }\r\n}\r\n\r\nfunction matchNameSpace(tagName: string, prefixMap: IPrefixMap): INameSpaceInfo | null {\r\n  for (const [prefix, info] of Object.entries(prefixMap)) {\r\n    if (tagName.startsWith(prefix + \"-\")) {\r\n      return info;\r\n    }\r\n  }\r\n  return null;\r\n}\r\n\r\nasync function tagLoad(tagInfo: ITagInfo, config: IConfig, prefixMap: IPrefixMap): Promise<void> {\r\n  const info: INameSpaceInfo | null = matchNameSpace(tagInfo.name, prefixMap);\r\n  if (info === null) {\r\n    throw new Error(\"No matching namespace found for lazy loaded component: \" + tagInfo.name);\r\n  }\r\n  \r\n  loadingTags.add(tagInfo.name);\r\n  try {\r\n    let loader: ILoader;\r\n    try {\r\n      loader = resolveLoader(\"\", info.loaderKey, config.loaders);\r\n    } catch (_e) {\r\n      throw new Error(\"Loader redirection is not supported for lazy loaded components: \" + tagInfo.name);\r\n    }\r\n\r\n    const file: string = tagInfo.name.slice(info.prefix.length + 1);\r\n    if (file === \"\") {\r\n      throw new Error(\"Invalid component name for lazy loaded component: \" + tagInfo.name);\r\n    }\r\n    const path = info.key + file + loader.postfix;\r\n\r\n    const componentConstructor = await loader.loader(path);\r\n    if (componentConstructor !== null) {\r\n      if (tagInfo.extends === null) {\r\n        customElements.define(tagInfo.name, componentConstructor);\r\n      } else {\r\n        customElements.define(tagInfo.name, componentConstructor, { extends: tagInfo.extends });\r\n      }\r\n    } else {\r\n      throw new Error(\"Loader returned null for component: \" + tagInfo.name);\r\n    }\r\n  } catch(e) {\r\n    console.error(`Failed to lazy load component '${tagInfo.name}':`, e);\r\n    failedTags.add(tagInfo.name);\r\n  } finally {\r\n    loadingTags.delete(tagInfo.name);\r\n  }\r\n}\r\n\r\n//\r\nasync function lazyLoad(root: Node, config: IConfig, prefixMap: IPrefixMap): Promise<number> {\r\n  const elements: Element[] = [];\r\n\r\n  // Create TreeWalker (target element and comment nodes)\r\n  const walker = document.createTreeWalker(\r\n    root, \r\n    NodeFilter.SHOW_ELEMENT,\r\n    (node: Node): number => {\r\n      return isCustomElement(node) ? NodeFilter.FILTER_ACCEPT : NodeFilter.FILTER_SKIP;\r\n    } \r\n  );\r\n  \r\n  // Move to next node with TreeWalker and add matching nodes to array\r\n  while (walker.nextNode()) {\r\n    elements.push(walker.currentNode as Element);\r\n  }\r\n\r\n  const tagInfos: ITagInfo[] = [];\r\n  const tagNames = new Set<string>();\r\n  for(const element of elements) {\r\n    const tagInfo = getCustomTagInfo(element);\r\n    const customClass = customElements.get(tagInfo.name);\r\n    if (customClass === undefined) {\r\n      // undefined\r\n      customElements.whenDefined(tagInfo.name).then(async () => {\r\n        // upgraded\r\n        await checkObserveShadowRoot(element, config, prefixMap);\r\n      });\r\n      if (!tagNames.has(tagInfo.name) && !failedTags.has(tagInfo.name)) {\r\n        tagNames.add(tagInfo.name);\r\n        tagInfos.push(tagInfo);\r\n      }\r\n    } else {\r\n      // upgraded\r\n      await checkObserveShadowRoot(element, config, prefixMap);\r\n    }\r\n  }\r\n  let tagCount = 0;\r\n  for(const tagInfo of tagInfos) {\r\n    await tagLoad(tagInfo, config, prefixMap);\r\n    tagCount++;\r\n  }\r\n  return tagCount;\r\n\r\n}\r\n\r\nasync function lazyLoads(\r\n  root: Document | ShadowRoot, \r\n  config: IConfig, \r\n  prefixMap: IPrefixMap\r\n): Promise<void> {\r\n  while(await lazyLoad(root, config, prefixMap) > 0) {\r\n    // Repeat until no more tags to load\r\n  }\r\n}\r\n\r\nexport async function handlerForLazyLoad(\r\n  root: Document | ShadowRoot, \r\n  config: IConfig,\r\n  prefixMap: IPrefixMap \r\n): Promise<void> {\r\n  if (Object.keys(prefixMap).length === 0) {\r\n    return;\r\n  }\r\n  try {\r\n    await lazyLoads(root, config, prefixMap);\r\n  } catch(e) {\r\n    throw new Error(\"Failed to lazy load components: \" + e);\r\n  }\r\n\r\n  if (!config.observable) {\r\n    return;\r\n  }\r\n  const mo = new MutationObserver(async (): Promise<void> => {\r\n    try {\r\n      await lazyLoads(root, config, prefixMap);\r\n    } catch(e) {\r\n      console.error(\"Failed to lazy load components: \" + e);\r\n    }\r\n  });\r\n  mo.observe(root instanceof Document ? root.documentElement : root, { childList: true, subtree: true });\r\n}\r\n","import { buildMap, loadImportmap } from \"./importmap.js\";\r\nimport { config } from \"./config.js\";\r\nimport { eagerLoad } from \"./eagerload.js\";\r\nimport { handlerForLazyLoad } from \"./lazyLoad.js\";\r\n\r\nexport async function registerHandler(): Promise<void> {\r\n  const importmap = loadImportmap(); // 事前に importmap を読み込んでおく\r\n  if (importmap === null) {\r\n    return;\r\n  }\r\n  const { prefixMap, loadMap } = buildMap(importmap);\r\n  // 先にeager loadを実行すると、DOMContentLoadedイベントが発生しないことがあるため、後に実行する\r\n  document.addEventListener(\"DOMContentLoaded\", async (): Promise<void> => {\r\n    await handlerForLazyLoad(document, config, prefixMap);\r\n  });\r\n\r\n  try {\r\n    await eagerLoad(loadMap, config.loaders);\r\n  } catch(e) {\r\n    throw new Error(\"Failed to eager load components: \" + e);\r\n  }\r\n}\r\n\r\n","import { ILoader } from \"./types\";\r\nimport { config } from \"./config.js\";\r\n\r\nexport function addLoader(key: string, loader: ILoader): void {\r\n  config.loaders[key] = loader;\r\n}\r\n"],"names":["COMPONENT_KEYWORD","getKeyInfoFromImportmapKey","key","startsWith","endsWith","prefixWithLoader","slice","length","prefix","loaderKey","split","Error","replaceAll","toLowerCase","isNameSpaced","tagNamePart","tagName","loaderKeyPart","extendsText","extends","DEFAULT_KEY","VANILLA_KEY","VANILLA_LOADER","postfix","loader","async","path","import","default","config","scanImportmap","loaders","observable","resolveLoader","resolvedLoader","candidates","l","Object","entries","currentLoader","push","sort","a","b","failedTags","Set","loadingTags","EXTENDS_MAP","Map","window","HTMLButtonElement","HTMLInputElement","HTMLAnchorElement","HTMLImageElement","HTMLDivElement","HTMLSpanElement","HTMLParagraphElement","HTMLUListElement","HTMLOListElement","HTMLLIElement","HTMLTableElement","HTMLFormElement","HTMLLabelElement","HTMLSelectElement","HTMLTextAreaElement","HTMLHeadingElement","HTMLQuoteElement","HTMLPreElement","HTMLBRElement","HTMLHRElement","HTMLModElement","HTMLTableCaptionElement","HTMLTableColElement","HTMLTableSectionElement","HTMLTableRowElement","HTMLTableCellElement","HTMLFieldSetElement","HTMLLegendElement","HTMLDListElement","HTMLOptGroupElement","HTMLOptionElement","HTMLStyleElement","HTMLScriptElement","HTMLTemplateElement","HTMLCanvasElement","HTMLIFrameElement","HTMLObjectElement","HTMLEmbedElement","HTMLVideoElement","HTMLAudioElement","HTMLTrackElement","HTMLMapElement","HTMLAreaElement","HTMLSourceElement","HTMLParamElement","HTMLMeterElement","HTMLProgressElement","HTMLOutputElement","HTMLDetailsElement","HTMLDialogElement","HTMLMenuElement","HTMLSlotElement","HTMLTimeElement","HTMLDataElement","HTMLPictureElement","forEach","cls","tag","set","eagerLoadItem","info","componentConstructor","extendsName","prototype","resolveExtends","customElements","define","e","has","console","error","add","getCustomTagInfo","elementTagName","name","includes","getAttribute","observedCustomElements","checkObserveShadowRoot","element","prefixMap","shadowRoot","handlerForLazyLoad","observeShadowRoot","tagLoad","tagInfo","matchNameSpace","_e","file","delete","lazyLoad","root","elements","walker","document","createTreeWalker","NodeFilter","SHOW_ELEMENT","node","Element","isCustomElement","FILTER_ACCEPT","FILTER_SKIP","nextNode","currentNode","tagInfos","tagNames","undefined","get","whenDefined","then","tagCount","lazyLoads","keys","MutationObserver","observe","Document","documentElement","childList","subtree","registerHandler","importmap","imports","querySelectorAll","script","json","JSON","parse","innerHTML","assign","loadImportmap","loadMap","_value","keyInfo","buildMap","addEventListener","promises","Promise","all","eagerLoad","addLoader"],"mappings":"AAEA,MAAMA,EAAoB,eAmB1B,SAASC,EAA2BC,GAClC,GAAIA,EAAIC,WAAWH,GAAoB,CACrC,GAAIE,EAAIE,SAAS,KAAM,CACrB,MAAMC,EAAmBH,EAAII,MAAMN,GAA0BE,EAAIK,OAAS,IAClEC,EAAQC,GAAcJ,EAAiBK,MAAM,IAAK,GAC1D,GAAe,KAAXF,EACF,MAAM,IAAIG,MAAM,0BAA4BT,GAE9C,MAAO,CACLA,MACAM,OAAQA,EAAOI,WAAW,IAAK,KAAKC,cACpCJ,UAAWA,GAAa,KACxBK,cAAc,EAElB,CAAO,CACL,MAAMC,EAAcb,EAAII,MAAMN,KACtBgB,EAASC,GAAkBF,EAAYL,MAAM,IAAK,IAClDD,EAAWS,IAAiBD,GAAiB,IAAIP,MAAM,IAAK,GACpE,GAAgB,KAAZM,EACF,MAAM,IAAIL,MAAM,0BAA4BT,GAE9C,MAAO,CACLA,MACAc,QAASA,EAAQJ,WAAW,IAAK,KAAKC,cACtCJ,UAAWA,GAAa,KACxBU,QAASD,GAAe,KACxBJ,cAAc,EAElB,CACF,CACA,OAAO,IACT,CChDO,MAAMM,EAAc,IAEdC,EAAc,UAEdC,EAAiB,CAC5BC,QAAS,MACTC,OCRKC,eAAoBC,GAEzB,aADqBC,OAAOD,IACdE,OAChB,GDiBaC,EATmB,CAC9BC,eAAe,EACfC,QAAS,CACPV,CAACA,GAAcC,EACfF,CAACA,GAAcC,GAEjBW,YAAY,YEhBEC,EACdP,EACAjB,EACAsB,GAEA,IAAIP,EAEJ,GAAkB,OAAdf,GAAsBA,IAAcW,GAA6B,KAAdX,EAAkB,CAEvE,IAAIyB,EAAiC,KAErC,MAAMC,EAAwB,GAC9B,IAAK,MAAOjC,EAAKkC,KAAMC,OAAOC,QAAQP,GAAU,CAC9C,GAAI7B,IAAQkB,EAAa,SACzB,MAAMmB,EAA6B,iBAANH,EAAiBL,EAAQK,GAAKA,EAC9B,iBAAlBG,GACXJ,EAAWK,KAAKD,EAClB,CAGAJ,EAAWM,KAAK,CAACC,EAAGC,IAAMA,EAAEpB,QAAQhB,OAASmC,EAAEnB,QAAQhB,QAEvD,IAAK,MAAMgC,KAAiBJ,EAC1B,GAAIT,EAAKtB,SAASmC,EAAchB,SAAU,CACxCW,EAAiBK,EACjB,KACF,CAGEL,EACFV,EAASU,GAETV,EAASO,EAAQX,GACK,iBAAXI,IACTA,EAASO,EAAQP,IAGvB,MAEE,GADAA,EAASO,EAAQtB,IACZe,EACH,MAAM,IAAIb,MAAM,qBAAuBF,GAI3C,GAAsB,iBAAXe,EACT,MAAM,IAAIb,MAAM,4CAElB,OAAOa,CACT,CClDO,MAAMoB,EAAa,IAAIC,IACjBC,EAAc,IAAID,ICEzBE,EAAc,IAAIC,IAExB,GAAsB,oBAAXC,OAAwB,CACrB,CACV,CAACC,kBAAmB,UACpB,CAACC,iBAAkB,SACnB,CAACC,kBAAmB,KACpB,CAACC,iBAAkB,OACnB,CAACC,eAAgB,OACjB,CAACC,gBAAiB,QAClB,CAACC,qBAAsB,KACvB,CAACC,iBAAkB,MACnB,CAACC,iBAAkB,MACnB,CAACC,cAAe,MAChB,CAACC,iBAAkB,SACnB,CAACC,gBAAiB,QAClB,CAACC,iBAAkB,SACnB,CAACC,kBAAmB,UACpB,CAACC,oBAAqB,YACtB,CAACC,mBAAoB,MACrB,CAACC,iBAAkB,cACnB,CAACC,eAAgB,OACjB,CAACC,cAAe,MAChB,CAACC,cAAe,MAChB,CAACC,eAAgB,OACjB,CAACC,wBAAyB,WAC1B,CAACC,oBAAqB,OACtB,CAACC,wBAAyB,SAC1B,CAACC,oBAAqB,MACtB,CAACC,qBAAsB,MACvB,CAACC,oBAAqB,YACtB,CAACC,kBAAmB,UACpB,CAACC,iBAAkB,MACnB,CAACC,oBAAqB,YACtB,CAACC,kBAAmB,UACpB,CAACC,iBAAkB,SACnB,CAACC,kBAAmB,UACpB,CAACC,oBAAqB,YACtB,CAACC,kBAAmB,UACpB,CAACC,kBAAmB,UACpB,CAACC,kBAAmB,UACpB,CAACC,iBAAkB,SACnB,CAACC,iBAAkB,SACnB,CAACC,iBAAkB,SACnB,CAACC,iBAAkB,SACnB,CAACC,eAAgB,OACjB,CAACC,gBAAiB,QAClB,CAACC,kBAAmB,UACpB,CAACC,iBAAkB,SACnB,CAACC,iBAAkB,SACnB,CAACC,oBAAqB,YACtB,CAACC,kBAAmB,UACpB,CAACC,mBAAoB,WACrB,CAACC,kBAAmB,UACpB,CAACC,gBAAiB,QAClB,CAACC,gBAAiB,QAClB,CAACC,gBAAiB,QAClB,CAACC,gBAAiB,QAClB,CAACC,mBAAoB,YAGnBC,QAAQ,EAAEC,EAAKC,WAEE,IAARD,GACT3D,EAAY6D,IAAIF,EAAKC,IAG3B,CAWAlF,eAAeoF,EAAcC,EAAsB9F,EAAgBQ,GACjE,IACE,MAAMuF,QAA6BvF,EAAOA,OAAOsF,EAAK5G,KACtD,GAA6B,OAAzB6G,EAA+B,CACjC,IAAIC,EAAcF,EAAK3F,QACH,OAAhB6F,IACFA,EAfR,SAAwBD,GACtB,IAAK,MAAOL,EAAKC,KAAQ5D,EACvB,GAAIgE,EAAqBE,qBAAqBP,EAC5C,OAAOC,EAGX,OAAO,IACT,CAQsBO,CAAeH,IAGX,OAAhBC,EACFG,eAAeC,OAAOpG,EAAS+F,GAE/BI,eAAeC,OAAOpG,EAAS+F,EAAsB,CAAE5F,QAAS6F,GAEpE,CACF,CAAE,MAAMK,GACDzE,EAAW0E,IAAItG,KAClBuG,QAAQC,MAAM,mCAAmCxG,MAAaqG,GAC9DzE,EAAW6E,IAAIzG,GAEnB,CAEF,CChGM,SAAU0G,EAAiBL,GAC/B,MAAMM,EAAiBN,EAAErG,QAAQH,cACjC,IAAI+G,EACAZ,EACJ,GAAIW,EAAeE,SAAS,KAC1BD,EAAOD,EACPX,EAAc,SACT,CACL,MAAMhG,EAAUqG,EAAES,aAAa,MAC/B,GAAgB,OAAZ9G,EACF,MAAM,IAAIL,MAAM,0DAA4DgH,GAE9E,IAAK3G,EAAQ6G,SAAS,KACpB,MAAM,IAAIlH,MAAM,uDAAyDgH,GAE3EC,EAAO5G,EACPgG,EAAcW,CAChB,CACA,MAAO,CAAEC,OAAMzG,QAAS6F,EAC1B,CAEA,MAAMe,EAA2C,IAAIlF,IAOrDpB,eAAeuG,EAAuBC,EAAkBpG,EAAiBqG,GACnED,EAAQE,aACLJ,EAAuBT,IAAIW,UAPpCxG,eAAiCwG,EAAkBpG,EAAiBqG,GAClEH,EAAuBN,IAAIQ,SACrBG,EAAmBH,EAAQE,WAAatG,EAAQqG,EACxD,CAKYG,CAAkBJ,EAASpG,EAAQqG,GAG/C,CAWAzG,eAAe6G,EAAQC,EAAmB1G,EAAiBqG,GACzD,MAAMpB,EAVR,SAAwB9F,EAAiBkH,GACvC,IAAK,MAAO1H,EAAQsG,KAASzE,OAAOC,QAAQ4F,GAC1C,GAAIlH,EAAQb,WAAWK,EAAS,KAC9B,OAAOsG,EAGX,OAAO,IACT,CAGsC0B,CAAeD,EAAQX,KAAMM,GACjE,GAAa,OAATpB,EACF,MAAM,IAAInG,MAAM,0DAA4D4H,EAAQX,MAGtF9E,EAAY2E,IAAIc,EAAQX,MACxB,IACE,IAAIpG,EACJ,IACEA,EAASS,EAAc,GAAI6E,EAAKrG,UAAWoB,EAAOE,QACpD,CAAE,MAAO0G,GACP,MAAM,IAAI9H,MAAM,mEAAqE4H,EAAQX,KAC/F,CAEA,MAAMc,EAAeH,EAAQX,KAAKtH,MAAMwG,EAAKtG,OAAOD,OAAS,GAC7D,GAAa,KAATmI,EACF,MAAM,IAAI/H,MAAM,qDAAuD4H,EAAQX,MAEjF,MAAMlG,EAAOoF,EAAK5G,IAAMwI,EAAOlH,EAAOD,QAEhCwF,QAA6BvF,EAAOA,OAAOE,GACjD,GAA6B,OAAzBqF,EAOF,MAAM,IAAIpG,MAAM,uCAAyC4H,EAAQX,MANzC,OAApBW,EAAQpH,QACVgG,eAAeC,OAAOmB,EAAQX,KAAMb,GAEpCI,eAAeC,OAAOmB,EAAQX,KAAMb,EAAsB,CAAE5F,QAASoH,EAAQpH,SAKnF,CAAE,MAAMkG,GACNE,QAAQC,MAAM,kCAAkCe,EAAQX,SAAUP,GAClEzE,EAAW6E,IAAIc,EAAQX,KACzB,SACE9E,EAAY6F,OAAOJ,EAAQX,KAC7B,CACF,CAGAnG,eAAemH,EAASC,EAAYhH,EAAiBqG,GACnD,MAAMY,EAAsB,GAGtBC,EAASC,SAASC,iBACtBJ,EACAK,WAAWC,aACVC,GAhGmB,CAACA,IACfA,aAAgBC,UAAYD,EAAKpI,QAAQ6G,SAAS,MAAQuB,EAAKtB,aAAa,OAAOD,SAAS,SAAU,EAgGnGyB,CAAgBF,GAAQF,WAAWK,cAAgBL,WAAWM,aAKzE,KAAOT,EAAOU,YACZX,EAAStG,KAAKuG,EAAOW,aAGvB,MAAMC,EAAuB,GACvBC,EAAW,IAAI/G,IACrB,IAAI,MAAMoF,KAAWa,EAAU,CAC7B,MAAMP,EAAUb,EAAiBO,QAEb4B,IADA1C,eAAe2C,IAAIvB,EAAQX,OAG7CT,eAAe4C,YAAYxB,EAAQX,MAAMoC,KAAKvI,gBAEtCuG,EAAuBC,EAASpG,EAAQqG,KAE3C0B,EAAStC,IAAIiB,EAAQX,OAAUhF,EAAW0E,IAAIiB,EAAQX,QACzDgC,EAASnC,IAAIc,EAAQX,MACrB+B,EAASnH,KAAK+F,WAIVP,EAAuBC,EAASpG,EAAQqG,EAElD,CACA,IAAI+B,EAAW,EACf,IAAI,MAAM1B,KAAWoB,QACbrB,EAAQC,EAAS1G,EAAQqG,GAC/B+B,IAEF,OAAOA,CAET,CAEAxI,eAAeyI,EACbrB,EACAhH,EACAqG,GAEA,WAAYU,EAASC,EAAMhH,EAAQqG,GAAa,IAGlD,CAEOzG,eAAe2G,EACpBS,EACAhH,EACAqG,GAEA,GAAsC,IAAlC7F,OAAO8H,KAAKjC,GAAW3H,OACzB,OAEF,UACQ2J,EAAUrB,EAAMhH,EAAQqG,EAChC,CAAE,MAAMb,GACN,MAAM,IAAI1G,MAAM,mCAAqC0G,EACvD,CAEA,IAAKxF,EAAOG,WACV,OAES,IAAIoI,iBAAiB3I,UAC9B,UACQyI,EAAUrB,EAAMhH,EAAQqG,EAChC,CAAE,MAAMb,GACNE,QAAQC,MAAM,mCAAqCH,EACrD,IAECgD,QAAQxB,aAAgByB,SAAWzB,EAAK0B,gBAAkB1B,EAAM,CAAE2B,WAAW,EAAMC,SAAS,GACjG,CCzKOhJ,eAAeiJ,IACpB,MAAMC,aPDN,MAAMA,EAAwB,CAAEC,QAAS,IAWzC,OAVA5B,SAAS6B,iBAAiB,4BAA4BpE,QAASqE,IAC7D,IACE,MAAMC,EAAOC,KAAKC,MAAMH,EAAOI,WAC3BH,EAAKH,UACPD,EAAUC,QAAUvI,OAAO8I,OAAOR,EAAUC,QAASG,EAAKH,SAE9D,CAAE,MAAOvD,GACP,MAAM,IAAI1G,MAAM,mCAAqC0G,EACvD,IAEKhF,OAAO8H,KAAKQ,EAAUC,SAASrK,OAAS,EAC3CoK,EACA,IACN,COboBS,GAClB,GAAkB,OAAdT,EACF,OAEF,MAAMzC,UAAEA,EAASmD,QAAEA,GP4Cf,SAAmBV,GAGvB,MAAMzC,EAAwB,CAAA,EACxBmD,EAAoB,CAAA,EAC1B,IAAK,MAAOnL,EAAKoL,KAAWjJ,OAAOC,QAAQqI,EAAUC,SAAU,CAC7D,MAAMW,EAAUtL,EAA2BC,GAC3B,OAAZqL,IAGAA,EAAQzK,aACVoH,EAAUqD,EAAQ/K,QAAU+K,EAE5BF,EAAQE,EAAQvK,SAAWuK,EAE/B,CACA,MAAO,CAAErD,YAAWmD,UACtB,CO7DiCG,CAASb,GAExC3B,SAASyC,iBAAiB,mBAAoBhK,gBACtC2G,EAAmBY,SAAUnH,EAAQqG,KAG7C,UF0FKzG,eACL4J,EACAtJ,GAEA,MAAM2J,EAA4B,GAClC,IAAI,MAAO1K,EAAS8F,KAASzE,OAAOC,QAAQ+I,GAAU,CACpD,IAAI7J,EACJ,IACEA,EAASS,EAAc6E,EAAK5G,IAAK4G,EAAKrG,UAAWsB,EACnD,CAAE,MAAO0G,GACP,MAAM,IAAI9H,MAAM,oEAAsEK,EACxF,CACA0K,EAASlJ,KAAKqE,EAAcC,EAAM9F,EAASQ,GAC7C,OACMmK,QAAQC,IAAIF,EACpB,CExGUG,CAAUR,EAASxJ,EAAOE,QAClC,CAAE,MAAMsF,GACN,MAAM,IAAI1G,MAAM,oCAAsC0G,EACxD,CACF,CClBM,SAAUyE,EAAU5L,EAAasB,GACrCK,EAAOE,QAAQ7B,GAAOsB,CACxB"}