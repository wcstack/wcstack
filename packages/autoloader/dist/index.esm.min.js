const e="*",t="vanilla",n={postfix:".js",loader:async function(e){return(await import(`${e}`)).default}},o={scanImportmap:!0,loaders:{[t]:n,[e]:t},observable:!0,tagNames:{autoloader:"wcs-autoloader"}},a=o;const r="@components/";function l(e){if(e.startsWith(r)){if(e.endsWith("/")){const t=e.slice(12,e.length-1),[n,o]=t.split("|",2);if(""===n)throw new Error("Invalid importmap key: "+e);return{key:e,prefix:n.replaceAll("/","-").toLowerCase(),loaderKey:o??null,isNameSpaced:!0}}{const t=e.slice(12),[n,o]=t.split("|",2),[a,r]=(o??"").split(",",2);if(""===n)throw new Error("Invalid importmap key: "+e);return{key:e,tagName:n.replaceAll("/","-").toLowerCase(),loaderKey:a||null,extends:r||null,isNameSpaced:!1}}}return null}function s(t,n,o){let a;if(null===n||n===e||""===n){let n=null;const r=[];for(const[t,n]of Object.entries(o)){if(t===e)continue;const a="string"==typeof n?o[n]:n;"string"!=typeof a&&r.push(a)}r.sort((e,t)=>t.postfix.length-e.postfix.length);for(const e of r)if(t.endsWith(e.postfix)){n=e;break}n?a=n:(a=o[e],"string"==typeof a&&(a=o[a]))}else if(a=o[n],!a)throw new Error("Loader not found: "+n);if("string"==typeof a)throw new Error("Loader redirection is not supported here");return a}const i=new Set,c=new Set,m=new Map;if("undefined"!=typeof window){[[HTMLButtonElement,"button"],[HTMLInputElement,"input"],[HTMLAnchorElement,"a"],[HTMLImageElement,"img"],[HTMLDivElement,"div"],[HTMLSpanElement,"span"],[HTMLParagraphElement,"p"],[HTMLUListElement,"ul"],[HTMLOListElement,"ol"],[HTMLLIElement,"li"],[HTMLTableElement,"table"],[HTMLFormElement,"form"],[HTMLLabelElement,"label"],[HTMLSelectElement,"select"],[HTMLTextAreaElement,"textarea"],[HTMLHeadingElement,"h1"],[HTMLQuoteElement,"blockquote"],[HTMLPreElement,"pre"],[HTMLBRElement,"br"],[HTMLHRElement,"hr"],[HTMLModElement,"ins"],[HTMLTableCaptionElement,"caption"],[HTMLTableColElement,"col"],[HTMLTableSectionElement,"tbody"],[HTMLTableRowElement,"tr"],[HTMLTableCellElement,"td"],[HTMLFieldSetElement,"fieldset"],[HTMLLegendElement,"legend"],[HTMLDListElement,"dl"],[HTMLOptGroupElement,"optgroup"],[HTMLOptionElement,"option"],[HTMLStyleElement,"style"],[HTMLScriptElement,"script"],[HTMLTemplateElement,"template"],[HTMLCanvasElement,"canvas"],[HTMLIFrameElement,"iframe"],[HTMLObjectElement,"object"],[HTMLEmbedElement,"embed"],[HTMLVideoElement,"video"],[HTMLAudioElement,"audio"],[HTMLTrackElement,"track"],[HTMLMapElement,"map"],[HTMLAreaElement,"area"],[HTMLSourceElement,"source"],[HTMLParamElement,"param"],[HTMLMeterElement,"meter"],[HTMLProgressElement,"progress"],[HTMLOutputElement,"output"],[HTMLDetailsElement,"details"],[HTMLDialogElement,"dialog"],[HTMLMenuElement,"menu"],[HTMLSlotElement,"slot"],[HTMLTimeElement,"time"],[HTMLDataElement,"data"],[HTMLPictureElement,"picture"]].forEach(([e,t])=>{void 0!==e&&m.set(e,t)})}async function d(e,t,n){try{if(customElements.get(t))return;const o=await n.loader(e.key);if(null!==o){let n=e.extends;if(null===n&&(n=function(e){for(const[t,n]of m)if(e.prototype instanceof t)return n;return null}(o)),customElements.get(t))return;null===n?customElements.define(t,o):customElements.define(t,o,{extends:n})}}catch(e){i.has(t)||(console.error(`Failed to eager load component '${t}':`,e),i.add(t))}}function u(e){const t=e.tagName.toLowerCase();let n,o;if(t.includes("-"))n=t,o=null;else{const a=e.getAttribute("is");if(null===a)throw new Error("Custom element without a dash or 'is' attribute found: "+t);if(!a.includes("-"))throw new Error("Custom element 'is' attribute without a dash found: "+t);n=a,o=t}return{name:n,extends:o}}const p=new WeakSet;async function f(e,t,n){e.shadowRoot&&(p.has(e)||await async function(e,t,n){p.add(e),await T(e.shadowRoot,t,n)}(e,t,n))}async function E(e,t,n){const o=function(e,t){for(const[n,o]of Object.entries(t))if(e.startsWith(n+"-"))return o;return null}(e.name,n);if(null===o)throw new Error("No matching namespace found for lazy loaded component: "+e.name);if(c.has(e.name))await customElements.whenDefined(e.name);else{c.add(e.name);try{let n;try{n=s("",o.loaderKey,t.loaders)}catch(t){throw new Error("Loader redirection is not supported for lazy loaded components: "+e.name)}const a=e.name.slice(o.prefix.length+1);if(""===a)throw new Error("Invalid component name for lazy loaded component: "+e.name);const r=o.key+a+n.postfix;if(customElements.get(e.name))return;const l=await n.loader(r);if(null===l)throw new Error("Loader returned null for component: "+e.name);if(customElements.get(e.name))return;null===e.extends?customElements.define(e.name,l):customElements.define(e.name,l,{extends:e.extends})}catch(t){console.error(`Failed to lazy load component '${e.name}':`,t),i.add(e.name)}finally{c.delete(e.name)}}}async function L(e,t,n){const o=[],a=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,e=>(e=>(e instanceof Element&&(e.tagName.includes("-")||e.getAttribute("is")?.includes("-")))??!1)(e)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP);for(;a.nextNode();)o.push(a.currentNode);const r=[],l=new Set;for(const e of o){const o=u(e);void 0===customElements.get(o.name)?(customElements.whenDefined(o.name).then(async()=>{await f(e,t,n)}),l.has(o.name)||i.has(o.name)||(l.add(o.name),r.push(o))):await f(e,t,n)}let s=0;for(const e of r)await E(e,t,n),s++;return s}async function M(e,t,n){for(;await L(e,t,n)>0;);}async function T(e,t,n){if(0===Object.keys(n).length)return null;try{await M(e,t,n)}catch(e){throw new Error("Failed to lazy load components: "+e)}if(!t.observable)return null;const o=new MutationObserver(async()=>{try{await M(e,t,n)}catch(e){console.error("Failed to lazy load components: "+e)}});return o.observe(e,{childList:!0,subtree:!0}),o}class h extends HTMLElement{static _instance=null;_initialized=!1;_prefixMap=null;_observer=null;constructor(){if(super(),h._instance)throw new Error(`${a.tagNames.autoloader} can only be instantiated once.`);h._instance=this;const e=function(){const e={imports:{}};return document.querySelectorAll('script[type="importmap"]').forEach(t=>{try{const n=JSON.parse(t.innerHTML);n.imports&&(e.imports=Object.assign(e.imports,n.imports))}catch(e){throw new Error("Failed to parse importmap JSON: "+e)}}),Object.keys(e.imports).length>0?e:null}();if(e){const{prefixMap:t,loadMap:n}=function(e){const t={},n={};for(const[o,a]of Object.entries(e.imports)){const e=l(o);null!==e&&(e.isNameSpaced?t[e.prefix]=e:n[e.tagName]=e)}return{prefixMap:t,loadMap:n}}(e);this._prefixMap=t,async function(e,t){const n=[];for(const[o,a]of Object.entries(e)){let e;try{e=s(a.key,a.loaderKey,t)}catch(e){throw new Error("Loader redirection is not supported for eager loaded components: "+o)}n.push(d(a,o,e))}await Promise.all(n)}(n,a.loaders).catch(e=>{console.error("Failed to eager load components:",e)})}}async connectedCallback(){this._initialized||(this._initialized=!0,this._prefixMap&&("loading"===document.readyState&&await new Promise(e=>document.addEventListener("DOMContentLoaded",()=>e(),{once:!0})),this._observer=await T(document,a,this._prefixMap)))}disconnectedCallback(){this._observer?.disconnect(),this._observer=null,h._instance===this&&(h._instance=null)}}function w(){customElements.get(a.tagNames.autoloader)||customElements.define(a.tagNames.autoloader,h)}function H(e){var t;e&&("boolean"==typeof(t=e).scanImportmap&&(o.scanImportmap=t.scanImportmap),t.loaders&&Object.assign(o.loaders,t.loaders),"boolean"==typeof t.observable&&(o.observable=t.observable),t.tagNames&&Object.assign(o.tagNames,t.tagNames)),w()}export{H as bootstrapAutoloader};
//# sourceMappingURL=index.esm.min.js.map
