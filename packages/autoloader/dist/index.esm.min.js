const e="@components/";function t(t){if(t.startsWith(e)){if(t.endsWith("/")){const e=t.slice(12,t.length-1),[n,o]=e.split("|",2);if(""===n)throw new Error("Invalid importmap key: "+t);return{key:t,prefix:n.replaceAll("/","-").toLowerCase(),loaderKey:o??null,isNameSpaced:!0}}{const e=t.slice(12),[n,o]=e.split("|",2),[r,a]=(o??"").split(",",2);if(""===n)throw new Error("Invalid importmap key: "+t);return{key:t,tagName:n.replaceAll("/","-").toLowerCase(),loaderKey:r||null,extends:a||null,isNameSpaced:!1}}}return null}const n="*",o="vanilla",r={postfix:".js",loader:async function(e){return(await import(e)).default}},a={scanImportmap:!0,loaders:{[o]:r,[n]:o},observable:!0};function l(e,t,o){let r;if(null===t||t===n||""===t){let t=null;const a=[];for(const[e,t]of Object.entries(o)){if(e===n)continue;const r="string"==typeof t?o[t]:t;"string"!=typeof r&&a.push(r)}a.sort((e,t)=>t.postfix.length-e.postfix.length);for(const n of a)if(e.endsWith(n.postfix)){t=n;break}t?r=t:(r=o[n],"string"==typeof r&&(r=o[r]))}else if(r=o[t],!r)throw new Error("Loader not found: "+t);if("string"==typeof r)throw new Error("Loader redirection is not supported here");return r}const s=new Set,i=new Set,m=new Map;if("undefined"!=typeof window){[[HTMLButtonElement,"button"],[HTMLInputElement,"input"],[HTMLAnchorElement,"a"],[HTMLImageElement,"img"],[HTMLDivElement,"div"],[HTMLSpanElement,"span"],[HTMLParagraphElement,"p"],[HTMLUListElement,"ul"],[HTMLOListElement,"ol"],[HTMLLIElement,"li"],[HTMLTableElement,"table"],[HTMLFormElement,"form"],[HTMLLabelElement,"label"],[HTMLSelectElement,"select"],[HTMLTextAreaElement,"textarea"],[HTMLHeadingElement,"h1"],[HTMLQuoteElement,"blockquote"],[HTMLPreElement,"pre"],[HTMLBRElement,"br"],[HTMLHRElement,"hr"],[HTMLModElement,"ins"],[HTMLTableCaptionElement,"caption"],[HTMLTableColElement,"col"],[HTMLTableSectionElement,"tbody"],[HTMLTableRowElement,"tr"],[HTMLTableCellElement,"td"],[HTMLFieldSetElement,"fieldset"],[HTMLLegendElement,"legend"],[HTMLDListElement,"dl"],[HTMLOptGroupElement,"optgroup"],[HTMLOptionElement,"option"],[HTMLStyleElement,"style"],[HTMLScriptElement,"script"],[HTMLTemplateElement,"template"],[HTMLCanvasElement,"canvas"],[HTMLIFrameElement,"iframe"],[HTMLObjectElement,"object"],[HTMLEmbedElement,"embed"],[HTMLVideoElement,"video"],[HTMLAudioElement,"audio"],[HTMLTrackElement,"track"],[HTMLMapElement,"map"],[HTMLAreaElement,"area"],[HTMLSourceElement,"source"],[HTMLParamElement,"param"],[HTMLMeterElement,"meter"],[HTMLProgressElement,"progress"],[HTMLOutputElement,"output"],[HTMLDetailsElement,"details"],[HTMLDialogElement,"dialog"],[HTMLMenuElement,"menu"],[HTMLSlotElement,"slot"],[HTMLTimeElement,"time"],[HTMLDataElement,"data"],[HTMLPictureElement,"picture"]].forEach(([e,t])=>{void 0!==e&&m.set(e,t)})}async function c(e,t,n){try{if(customElements.get(t))return;const o=await n.loader(e.key);if(null!==o){let n=e.extends;if(null===n&&(n=function(e){for(const[t,n]of m)if(e.prototype instanceof t)return n;return null}(o)),customElements.get(t))return;null===n?customElements.define(t,o):customElements.define(t,o,{extends:n})}}catch(e){s.has(t)||(console.error(`Failed to eager load component '${t}':`,e),s.add(t))}}function d(e){const t=e.tagName.toLowerCase();let n,o;if(t.includes("-"))n=t,o=null;else{const r=e.getAttribute("is");if(null===r)throw new Error("Custom element without a dash or 'is' attribute found: "+t);if(!r.includes("-"))throw new Error("Custom element 'is' attribute without a dash found: "+t);n=r,o=t}return{name:n,extends:o}}const u=new WeakSet;async function f(e,t,n){e.shadowRoot&&(u.has(e)||await async function(e,t,n){u.add(e),await T(e.shadowRoot,t,n)}(e,t,n))}async function p(e,t,n){const o=function(e,t){for(const[n,o]of Object.entries(t))if(e.startsWith(n+"-"))return o;return null}(e.name,n);if(null===o)throw new Error("No matching namespace found for lazy loaded component: "+e.name);if(i.has(e.name))await customElements.whenDefined(e.name);else{i.add(e.name);try{let n;try{n=l("",o.loaderKey,t.loaders)}catch(t){throw new Error("Loader redirection is not supported for lazy loaded components: "+e.name)}const r=e.name.slice(o.prefix.length+1);if(""===r)throw new Error("Invalid component name for lazy loaded component: "+e.name);const a=o.key+r+n.postfix;if(customElements.get(e.name))return;const s=await n.loader(a);if(null===s)throw new Error("Loader returned null for component: "+e.name);if(customElements.get(e.name))return;null===e.extends?customElements.define(e.name,s):customElements.define(e.name,s,{extends:e.extends})}catch(t){console.error(`Failed to lazy load component '${e.name}':`,t),s.add(e.name)}finally{i.delete(e.name)}}}async function E(e,t,n){const o=[],r=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,e=>(e=>(e instanceof Element&&(e.tagName.includes("-")||e.getAttribute("is")?.includes("-")))??!1)(e)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP);for(;r.nextNode();)o.push(r.currentNode);const a=[],l=new Set;for(const e of o){const o=d(e);void 0===customElements.get(o.name)?(customElements.whenDefined(o.name).then(async()=>{await f(e,t,n)}),l.has(o.name)||s.has(o.name)||(l.add(o.name),a.push(o))):await f(e,t,n)}let i=0;for(const e of a)await p(e,t,n),i++;return i}async function L(e,t,n){for(;await E(e,t,n)>0;);}async function T(e,t,n){if(0===Object.keys(n).length)return;try{await L(e,t,n)}catch(e){throw new Error("Failed to lazy load components: "+e)}if(!t.observable)return;new MutationObserver(async()=>{try{await L(e,t,n)}catch(e){console.error("Failed to lazy load components: "+e)}}).observe(e,{childList:!0,subtree:!0})}async function M(){const e=function(){const e={imports:{}};return document.querySelectorAll('script[type="importmap"]').forEach(t=>{try{const n=JSON.parse(t.innerHTML);n.imports&&(e.imports=Object.assign(e.imports,n.imports))}catch(e){throw new Error("Failed to parse importmap JSON: "+e)}}),Object.keys(e.imports).length>0?e:null}();if(null===e)return;const{prefixMap:n,loadMap:o}=function(e){const n={},o={};for(const[r,a]of Object.entries(e.imports)){const e=t(r);null!==e&&(e.isNameSpaced?n[e.prefix]=e:o[e.tagName]=e)}return{prefixMap:n,loadMap:o}}(e);document.addEventListener("DOMContentLoaded",async()=>{await T(document,a,n)});try{await async function(e,t){const n=[];for(const[o,r]of Object.entries(e)){let e;try{e=l(r.key,r.loaderKey,t)}catch(e){throw new Error("Loader redirection is not supported for eager loaded components: "+o)}n.push(c(r,o,e))}await Promise.all(n)}(o,a.loaders)}catch(e){throw new Error("Failed to eager load components: "+e)}}function w(e,t){a.loaders[e]=t}export{n as DEFAULT_KEY,o as VANILLA_KEY,r as VANILLA_LOADER,w as addLoader,a as config,M as registerHandler};
//# sourceMappingURL=index.esm.min.js.map
